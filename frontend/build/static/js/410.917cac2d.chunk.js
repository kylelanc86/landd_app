"use strict";(self.webpackChunkair_monitoring_frontend=self.webpackChunkair_monitoring_frontend||[]).push([[410],{4410:(e,s,r)=>{r.r(s),r.d(s,{default:()=>re});var i=r(89379),a=r(65043),t=r(85865),n=r(96446),l=r(43845),o=r(17392),c=r(11906),d=r(74605),u=r(19042),A=r(90035),h=r(26600),m=r(35316),x=r(88911),p=r(15795),v=r(53193),g=r(79190),j=r(72221),f=r(32143),b=r(12110),y=r(26494),C=r(68903),w=r(98587),N=r(58168),S=r(58387),k=r(98610),W=r(34535),U=r(98206),D=r(92532),M=r(72372);function T(e){return(0,M.Ay)("MuiCardActions",e)}(0,D.A)("MuiCardActions",["root","spacing"]);var L=r(70579);const R=["disableSpacing","className"],_=(0,W.Ay)("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:r}=e;return[s.root,!r.disableSpacing&&s.spacing]}})((e=>{let{ownerState:s}=e;return(0,N.A)({display:"flex",alignItems:"center",padding:8},!s.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})})),z=a.forwardRef((function(e,s){const r=(0,U.b)({props:e,name:"MuiCardActions"}),{disableSpacing:i=!1,className:a}=r,t=(0,w.A)(r,R),n=(0,N.A)({},r,{disableSpacing:i}),l=(e=>{const{classes:s,disableSpacing:r}=e,i={root:["root",!r&&"spacing"]};return(0,k.A)(i,T,s)})(n);return(0,L.jsx)(_,(0,N.A)({className:(0,S.A)(l.root,a),ownerState:n,ref:s},t))}));var E=r(29347),G=r(98533),I=r(95540),P=r(63471),F=r(19778),V=r(39423),q=r(22505),H=r(76164);const B=["admin","manager","employee"];var O=r(37660),J=r(21268),Z=(r(63777),r(26240)),K=r(94505),Q=r(10105),X=r(73216),Y=r(51271),$=r(95187);const ee=e=>e?["image/jpeg","image/jpg","image/png","image/gif"].includes(e.type)?e.size>5242880?{isValid:!1,error:"File size must be less than 5MB"}:{isValid:!0,error:null}:{isValid:!1,error:"Please select a valid image file (JPEG, PNG, or GIF)"}:{isValid:!1,error:"No file selected"},se={firstName:"",lastName:"",email:"",phone:"",role:"employee",isActive:!0,licences:[],signature:""},re=()=>{var e,s;const r=(0,X.Zp)(),{currentUser:w}=(0,$.As)(),[N,S]=(0,a.useState)([]),[k,W]=(0,a.useState)(!1),[U,D]=(0,a.useState)(!1),[M,T]=(0,a.useState)(!1),[R,_]=(0,a.useState)(se),[re,ie]=(0,a.useState)(se),[ae,te]=(0,a.useState)(null),[ne,le]=(0,a.useState)(null),[oe,ce]=(0,a.useState)(null),[de,ue]=(0,a.useState)("lastName"),[Ae,he]=(0,a.useState)("asc"),[me,xe]=(0,a.useState)(!1),pe=(0,Z.A)(),[ve,ge]=(0,a.useState)(!1),[je,fe]=(0,a.useState)(null);(0,a.useEffect)((()=>{(async()=>{try{const e=await K.Dv.getAll();console.log("Users data from API:",e.data);const s=e.data.map((e=>(0,i.A)((0,i.A)({},e),{},{role:e.role||"employee"})));S(s)}catch(e){console.error("Error fetching users:",e)}})()}),[]);const be=e=>{_((0,i.A)((0,i.A)({},R),{},{[e.target.name]:e.target.value}))},ye=e=>{ie((0,i.A)((0,i.A)({},re),{},{[e.target.name]:e.target.value}))},Ce=(e,s,r)=>{const a=[...R.licences];a[e]=(0,i.A)((0,i.A)({},a[e]),{},{[s]:r}),_((0,i.A)((0,i.A)({},R),{},{licences:a}))},we=(e,s,r)=>{const a=[...re.licences];a[e]=(0,i.A)((0,i.A)({},a[e]),{},{[s]:r}),ie((0,i.A)((0,i.A)({},re),{},{licences:a}))},Ne=([...N].sort(((e,s)=>{let r=e[de],i=s[de];return r<i?"asc"===Ae?-1:1:r>i?"asc"===Ae?1:-1:0})),[{field:"name",headerName:"Name",flex:1.5,maxWidth:180,renderCell:e=>{const s="".concat(e.row.firstName||""," ").concat(e.row.lastName||"").trim();return(0,L.jsx)(Q.A,{value:s})}},{field:"email",headerName:"Email",flex:1,renderCell:e=>(0,L.jsx)(Q.A,{value:e.value})},{field:"role",headerName:"User Level",flex:1,minWidth:120,renderCell:e=>{const s=e.row.role||"employee",r=s.charAt(0).toUpperCase()+s.slice(1);return(0,L.jsx)(Q.A,{value:r})}},{field:"licences",headerName:"Licences",flex:1.5,minWidth:150,renderCell:e=>{const s=e.row.licences||[];return 0===s.length?(0,L.jsx)(t.A,{variant:"body2",color:"textSecondary",children:"No licences"}):(0,L.jsx)(n.A,{children:s.map(((e,s)=>(0,L.jsx)(t.A,{variant:"body2",children:e.licenceType},s)))})}},{field:"isActive",headerName:"Status",flex:1,maxWidth:100,renderCell:e=>(0,L.jsx)(l.A,{label:e.value?"Active":"Inactive",color:e.value?"success":"error",sx:{color:"white"}})},{field:"actions",headerName:"Actions",flex:1,minWidth:150,renderCell:e=>(0,L.jsxs)(n.A,{children:[(0,L.jsx)(o.A,{onClick:()=>{return s=e.row,console.log("Editing user:",s),te(s._id),ie({firstName:s.firstName||"",lastName:s.lastName||"",email:s.email||"",phone:s.phone||"",role:s.role||"employee",isActive:s.isActive,licences:s.licences||[],signature:s.signature||""}),void D(!0);var s},children:(0,L.jsx)(I.A,{})}),(0,L.jsx)(o.A,{onClick:()=>((e,s)=>{if(!s&&"admin"===N.find((s=>s._id===e)).role&&N.filter((e=>e.isActive&&"admin"===e.role)).length<=1)return T(!0),le(e),void ce(s);le(e),ce(s),T(!0)})(e.row._id,!e.row.isActive),title:e.row.isActive?"Deactivate User":"Activate User",children:e.row.isActive?(0,L.jsx)(P.A,{}):(0,L.jsx)(F.A,{})}),(0,Y._m)(w,"timesheets.approve")&&e.row._id!==w._id&&(0,L.jsx)(o.A,{onClick:()=>{return s=e.row._id,void r("/timesheets/review?userId=".concat(s));var s},title:"View Timesheets",children:(0,L.jsx)(V.A,{})})]}),sortable:!1,filterable:!1}]),Se=N.filter((e=>me||e.isActive));return(0,L.jsxs)(n.A,{m:"20px",children:[(0,L.jsxs)(n.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,L.jsx)(O.A,{title:"USER MANAGEMENT",subtitle:"Manage your users"}),(0,L.jsx)(c.A,{variant:"contained",color:"secondary",onClick:()=>W(!0),sx:{backgroundColor:pe.palette.secondary.main,"&:hover":{backgroundColor:pe.palette.secondary.dark}},children:"Add User"})]}),(0,L.jsxs)(n.A,{mt:"20px",children:[(0,L.jsxs)(n.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:"10px",children:[(0,L.jsx)(t.A,{variant:"h5",color:"black",children:"Users"}),(0,L.jsx)(d.A,{control:(0,L.jsx)(u.A,{checked:me,onChange:e=>xe(e.target.checked),color:"secondary"}),label:"Show Inactive Users",sx:{color:"black"}})]}),(0,L.jsx)(n.A,{height:"75vh",sx:{"& .MuiDataGrid-root":{border:"none"},"& .MuiDataGrid-cell":{borderBottom:"1px solid ".concat(pe.palette.divider)},"& .MuiDataGrid-columnHeaders":{backgroundColor:pe.palette.primary.dark,borderBottom:"none"},"& .MuiDataGrid-virtualScroller":{backgroundColor:pe.palette.background.default},"& .MuiDataGrid-footerContainer":{borderTop:"none",backgroundColor:pe.palette.primary.dark},"& .MuiCheckbox-root":{color:"".concat(pe.palette.secondary.main," !important")},"& .MuiDataGrid-row:nth-of-type(even)":{backgroundColor:"#f8f9fa"},"& .MuiDataGrid-row:nth-of-type(odd)":{backgroundColor:"#ffffff"},"& .MuiDataGrid-row:hover":{backgroundColor:"#e3f2fd"}},children:(0,L.jsx)(J.zh,{rows:Se,columns:Ne,getRowId:e=>e._id,pageSize:10,rowsPerPageOptions:[10],autoHeight:!0,disableSelectionOnClick:!0})})]}),(0,L.jsxs)(A.A,{open:k,onClose:()=>W(!1),maxWidth:"md",fullWidth:!0,children:[(0,L.jsx)(h.A,{children:"Add New User"}),(0,L.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),R.firstName.trim()&&R.lastName.trim()&&R.email.trim())try{const e=(0,i.A)((0,i.A)({},R),{},{password:"defaultPassword123",phone:R.phone.trim()||"",licences:R.licences.filter((e=>e.state&&e.licenceNumber&&e.licenceType)),signature:R.signature||""});console.log("Creating user with data:",e);const s=await K.Dv.create(e);S([s.data,...N]),_(se),W(!1)}catch(s){console.error("Error adding user:",s)}},children:[(0,L.jsxs)(m.A,{children:[(0,L.jsxs)(x.A,{direction:"row",spacing:2,sx:{mb:2},children:[(0,L.jsx)(p.A,{label:"First Name",name:"firstName",value:R.firstName,onChange:be,required:!0,sx:{flex:1}}),(0,L.jsx)(p.A,{label:"Last Name",name:"lastName",value:R.lastName,onChange:be,required:!0,sx:{flex:1}})]}),(0,L.jsxs)(x.A,{direction:"row",spacing:2,sx:{mb:2},children:[(0,L.jsx)(p.A,{label:"Email",name:"email",type:"email",value:R.email,onChange:be,required:!0,sx:{flex:1}}),(0,L.jsx)(p.A,{label:"Phone",name:"phone",value:R.phone,onChange:be,sx:{flex:1}})]}),(0,L.jsxs)(v.A,{fullWidth:!0,children:[(0,L.jsx)(g.A,{children:"User Level"}),(0,L.jsx)(j.A,{label:"User Level",name:"role",value:R.role,onChange:be,children:B.map((e=>(0,L.jsx)(f.A,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e)))})]}),(0,L.jsxs)(n.A,{sx:{mt:3},children:[(0,L.jsx)(t.A,{variant:"h6",sx:{mb:2},children:"Licences"}),R.licences.map(((e,s)=>(0,L.jsxs)(b.A,{sx:{mb:2,p:2},children:[(0,L.jsx)(y.A,{children:(0,L.jsxs)(C.Ay,{container:!0,spacing:2,children:[(0,L.jsx)(C.Ay,{item:!0,xs:4,children:(0,L.jsxs)(v.A,{fullWidth:!0,size:"small",children:[(0,L.jsx)(g.A,{children:"Licence Type"}),(0,L.jsxs)(j.A,{label:"Licence Type",value:e.licenceType,onChange:e=>Ce(s,"licenceType",e.target.value),children:[(0,L.jsx)(f.A,{value:"Asbestos Assessor",children:"Asbestos Assessor"}),(0,L.jsx)(f.A,{value:"White Card",children:"White Card"})]})]})}),(0,L.jsx)(C.Ay,{item:!0,xs:4,children:(0,L.jsx)(p.A,{label:"State",value:e.state,onChange:e=>Ce(s,"state",e.target.value),fullWidth:!0,size:"small"})}),(0,L.jsx)(C.Ay,{item:!0,xs:4,children:(0,L.jsx)(p.A,{label:"Licence Number",value:e.licenceNumber,onChange:e=>Ce(s,"licenceNumber",e.target.value),fullWidth:!0,size:"small"})})]})}),(0,L.jsx)(z,{children:(0,L.jsx)(o.A,{onClick:()=>(e=>{const s=R.licences.filter(((s,r)=>r!==e));_((0,i.A)((0,i.A)({},R),{},{licences:s}))})(s),color:"error",size:"small",children:(0,L.jsx)(H.A,{})})})]},s))),(0,L.jsx)(c.A,{startIcon:(0,L.jsx)(q.A,{}),onClick:()=>{_((0,i.A)((0,i.A)({},R),{},{licences:[...R.licences,{state:"",licenceNumber:"",licenceType:""}]}))},variant:"outlined",size:"small",children:"Add Licence"})]}),(0,L.jsxs)(n.A,{sx:{mt:3},children:[(0,L.jsx)(t.A,{variant:"h6",sx:{mb:2},children:"Signature"}),(0,L.jsx)("input",{accept:"image/*",style:{display:"none"},id:"signature-upload",type:"file",onChange:async e=>{const s=e.target.files[0];if(s){const e=ee(s);if(!e.isValid)return void alert(e.error);const r=new FileReader;r.onload=async e=>{_((0,i.A)((0,i.A)({},R),{},{signature:e.target.result}))},r.readAsDataURL(s)}}}),(0,L.jsx)("label",{htmlFor:"signature-upload",children:(0,L.jsx)(c.A,{variant:"outlined",component:"span",children:"Upload Signature"})}),R.signature&&(0,L.jsxs)(n.A,{sx:{mt:2},children:[(0,L.jsx)(t.A,{variant:"body2",sx:{mb:1},children:"Current Signature:"}),(0,L.jsx)(n.A,{component:"img",src:R.signature,alt:"Signature preview",sx:{maxWidth:200,maxHeight:100,border:"1px solid #ddd",borderRadius:1}})]})]})]}),(0,L.jsxs)(E.A,{children:[(0,L.jsx)(c.A,{onClick:()=>W(!1),color:"secondary",children:"Cancel"}),(0,L.jsx)(c.A,{type:"submit",variant:"contained",color:"primary",children:"Add User"})]})]})]}),(0,L.jsxs)(A.A,{open:U,onClose:()=>D(!1),maxWidth:"md",fullWidth:!0,children:[(0,L.jsx)(h.A,{children:"Edit User"}),(0,L.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e={firstName:re.firstName,lastName:re.lastName,email:re.email,phone:re.phone.trim()||"",role:re.role,isActive:re.isActive,licences:re.licences.filter((e=>e.state&&e.licenceNumber&&e.licenceType)),signature:re.signature||""};console.log("Updating user with data:",e);const s=await K.Dv.update(ae,e);S(N.map((e=>e._id===ae?s.data:e))),D(!1),te(null),ie(se)}catch(s){console.error("Error updating user:",s)}},children:[(0,L.jsxs)(m.A,{children:[(0,L.jsxs)(x.A,{direction:"row",spacing:2,sx:{mb:2},children:[(0,L.jsx)(p.A,{label:"First Name",name:"firstName",value:re.firstName,onChange:ye,required:!0,sx:{flex:1}}),(0,L.jsx)(p.A,{label:"Last Name",name:"lastName",value:re.lastName,onChange:ye,required:!0,sx:{flex:1}})]}),(0,L.jsxs)(x.A,{direction:"row",spacing:2,sx:{mb:2},children:[(0,L.jsx)(p.A,{label:"Email",name:"email",type:"email",value:re.email,onChange:ye,required:!0,sx:{flex:1}}),(0,L.jsx)(p.A,{label:"Phone",name:"phone",value:re.phone||"",onChange:ye,sx:{flex:1}})]}),(0,L.jsxs)(x.A,{direction:"row",spacing:2,sx:{mb:2},children:[(0,L.jsxs)(v.A,{fullWidth:!0,children:[(0,L.jsx)(g.A,{children:"User Level"}),(0,L.jsx)(j.A,{label:"User Level",name:"role",value:re.role,onChange:ye,children:B.map((e=>(0,L.jsx)(f.A,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e)))})]}),(0,L.jsx)(d.A,{control:(0,L.jsx)(u.A,{checked:re.isActive,onChange:e=>ie((0,i.A)((0,i.A)({},re),{},{isActive:e.target.checked})),color:"primary"}),label:"Active",sx:{minWidth:"120px"}})]}),(0,L.jsxs)(n.A,{sx:{mt:3},children:[(0,L.jsx)(t.A,{variant:"h6",sx:{mb:2},children:"Licences"}),re.licences.map(((e,s)=>(0,L.jsxs)(b.A,{sx:{mb:2,p:2},children:[(0,L.jsx)(y.A,{children:(0,L.jsxs)(C.Ay,{container:!0,spacing:2,children:[(0,L.jsx)(C.Ay,{item:!0,xs:4,children:(0,L.jsxs)(v.A,{fullWidth:!0,size:"small",children:[(0,L.jsx)(g.A,{children:"Licence Type"}),(0,L.jsxs)(j.A,{label:"Licence Type",value:e.licenceType,onChange:e=>we(s,"licenceType",e.target.value),children:[(0,L.jsx)(f.A,{value:"Asbestos Assessor",children:"Asbestos Assessor"}),(0,L.jsx)(f.A,{value:"White Card",children:"White Card"})]})]})}),(0,L.jsx)(C.Ay,{item:!0,xs:4,children:(0,L.jsx)(p.A,{label:"State",value:e.state,onChange:e=>we(s,"state",e.target.value),fullWidth:!0,size:"small"})}),(0,L.jsx)(C.Ay,{item:!0,xs:4,children:(0,L.jsx)(p.A,{label:"Licence Number",value:e.licenceNumber,onChange:e=>we(s,"licenceNumber",e.target.value),fullWidth:!0,size:"small"})})]})}),(0,L.jsx)(z,{children:(0,L.jsx)(o.A,{onClick:()=>(e=>{const s=re.licences.filter(((s,r)=>r!==e));ie((0,i.A)((0,i.A)({},re),{},{licences:s}))})(s),color:"error",size:"small",children:(0,L.jsx)(H.A,{})})})]},s))),(0,L.jsx)(c.A,{startIcon:(0,L.jsx)(q.A,{}),onClick:()=>{ie((0,i.A)((0,i.A)({},re),{},{licences:[...re.licences,{state:"",licenceNumber:"",licenceType:""}]}))},variant:"outlined",size:"small",children:"Add Licence"})]}),(0,L.jsxs)(n.A,{sx:{mt:3},children:[(0,L.jsx)(t.A,{variant:"h6",sx:{mb:2},children:"Signature"}),(0,L.jsx)("input",{accept:"image/*",style:{display:"none"},id:"edit-signature-upload",type:"file",onChange:async e=>{const s=e.target.files[0];if(s){const e=ee(s);if(!e.isValid)return void alert(e.error);const r=new FileReader;r.onload=async e=>{ie((0,i.A)((0,i.A)({},re),{},{signature:e.target.result}))},r.readAsDataURL(s)}}}),(0,L.jsx)("label",{htmlFor:"edit-signature-upload",children:(0,L.jsx)(c.A,{variant:"outlined",component:"span",children:"Upload Signature"})}),re.signature&&(0,L.jsxs)(n.A,{sx:{mt:2},children:[(0,L.jsx)(t.A,{variant:"body2",sx:{mb:1},children:"Current Signature:"}),(0,L.jsx)(n.A,{component:"img",src:re.signature,alt:"Signature preview",sx:{maxWidth:200,maxHeight:100,border:"1px solid #ddd",borderRadius:1}})]})]})]}),(0,L.jsxs)(E.A,{children:[(0,L.jsx)(c.A,{onClick:()=>D(!1),color:"secondary",children:"Cancel"}),(0,L.jsx)(c.A,{type:"submit",variant:"contained",color:"primary",children:"Save Changes"})]})]})]}),(0,L.jsxs)(A.A,{open:M,onClose:()=>T(!1),children:[(0,L.jsx)(h.A,{children:oe?"Confirm Restore":"Confirm Deactivate"}),(0,L.jsx)(m.A,{children:(0,L.jsx)(G.A,{children:oe?"Are you sure you want to restore this user? They will regain access to the system.":"admin"===(null===(e=N.find((e=>e._id===ne)))||void 0===e?void 0:e.role)&&N.filter((e=>e.isActive&&"admin"===e.role)).length<=1?"Cannot deactivate the last active admin user. Please ensure another admin user is active before deactivating this user.":"Are you sure you want to deactivate this user? They will lose access to the system but can be restored later."})}),(0,L.jsxs)(E.A,{children:[(0,L.jsx)(c.A,{onClick:()=>T(!1),color:"secondary",children:"Cancel"}),!("admin"===(null===(s=N.find((e=>e._id===ne)))||void 0===s?void 0:s.role)&&N.filter((e=>e.isActive&&"admin"===e.role)).length<=1)&&(0,L.jsx)(c.A,{onClick:async()=>{const e=N.find((e=>e._id===ne));if(!oe&&"admin"===e.role){if(N.filter((e=>e.isActive&&"admin"===e.role)).length<=1)return T(!1),le(null),void ce(null)}try{const e=await K.Dv.update(ne,{isActive:oe});S(N.map((s=>s._id===ne?e.data:s))),T(!1),le(null),ce(null)}catch(s){console.error("Error updating user status:",s)}},color:oe?"success":"error",variant:"contained",children:oe?"Restore":"Deactivate"})]})]})]})}},10105:(e,s,r)=>{r.d(s,{A:()=>l});r(65043);var i=r(96446),a=r(85865),t=r(77739),n=r(70579);const l=e=>{let{value:s,tooltip:r=!0}=e;if(!s)return null;const l=(0,n.jsx)(i.A,{sx:{width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(0,n.jsx)(a.A,{variant:"body2",noWrap:!0,children:s})});return r?(0,n.jsx)(t.A,{title:s,placement:"top",children:l}):l}},76164:(e,s,r)=>{var i=r(24994);s.A=void 0;var a=i(r(40039)),t=r(70579);s.A=(0,a.default)((0,t.jsx)("path",{d:"M19 13H5v-2h14z"}),"Remove")},98533:(e,s,r)=>{r.d(s,{A:()=>g});var i=r(98587),a=r(58168),t=r(65043),n=r(58387),l=r(98610),o=r(34535),c=r(61475),d=r(98206),u=r(85865),A=r(92532),h=r(72372);function m(e){return(0,h.Ay)("MuiDialogContentText",e)}(0,A.A)("MuiDialogContentText",["root"]);var x=r(70579);const p=["children","className"],v=(0,o.Ay)(u.A,{shouldForwardProp:e=>(0,c.A)(e)||"classes"===e,name:"MuiDialogContentText",slot:"Root",overridesResolver:(e,s)=>s.root})({}),g=t.forwardRef((function(e,s){const r=(0,d.b)({props:e,name:"MuiDialogContentText"}),{className:t}=r,o=(0,i.A)(r,p),c=(e=>{const{classes:s}=e,r=(0,l.A)({root:["root"]},m,s);return(0,a.A)({},s,r)})(o);return(0,x.jsx)(v,(0,a.A)({component:"p",variant:"body1",color:"text.secondary",ref:s,ownerState:o,className:(0,n.A)(c.root,t)},r,{classes:c}))}))}}]);
//# sourceMappingURL=410.917cac2d.chunk.js.map