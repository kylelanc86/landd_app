"use strict";(self.webpackChunkair_monitoring_frontend=self.webpackChunkair_monitoring_frontend||[]).push([[168],{3632:(e,t,a)=>{a.d(t,{A:()=>r});var n=a(59662),o=a(70579);const r=(0,n.A)((0,o.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")},30513:(e,t,a)=>{a.d(t,{A:()=>r});var n=a(59662),o=a(70579);const r=(0,n.A)((0,o.jsx)("path",{d:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3m-3 11H8v-5h8zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m-1-9H6v4h12z"}),"Print")},32058:(e,t,a)=>{a.d(t,{A:()=>r});var n=a(82431);const o="/asbestos-clearance-reports",r={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await n.A.get(o,{params:e})).data},getByClearanceId:async e=>(await n.A.get("".concat(o,"/clearance/").concat(e))).data,getById:async e=>(await n.A.get("".concat(o,"/").concat(e))).data,create:async e=>(await n.A.post(o,e)).data,update:async(e,t)=>(await n.A.put("".concat(o,"/").concat(e),t)).data,delete:async e=>(await n.A.delete("".concat(o,"/").concat(e))).data}},43381:(e,t,a)=>{a.r(t),a.d(t,{generateHTMLPDF:()=>r,generateHTMLTemplatePDF:()=>s,generateTemplatePDF:()=>o});var n=a(37762);a(65239);const o=async(e,t,a)=>{const o=new n.default,r=o.internal.pageSize.getWidth(),s=o.internal.pageSize.getHeight(),c=20,i=r-40;let l=c;const d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:11,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"normal",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8;if(!e)return l;o.setFontSize(t),o.setFont("helvetica",a);const r=o.splitTextToSize(e,i);return o.text(e,c,l,{maxWidth:i}),l+=r.length*t*1.2+n,l},p=function(e){return d(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:14,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"bold",12)};l=p(a(e.standardSections.frontCoverTitle||"Non-friable Asbestos Removal Clearance"),16,"bold"),l=d(a(e.standardSections.frontCoverSubtitle||""),12,"normal",20),l+=10,e.companyDetails&&(l=p("Company Details",12,"bold"),Object.entries(e.companyDetails).forEach((e=>{let[t,a]=e;const n=t.charAt(0).toUpperCase()+t.slice(1).replace(/([A-Z])/g," $1");l=d("".concat(n,": ").concat(a),10,"normal",4)})),l+=10),l=p(a(e.standardSections.inspectionDetailsTitle||"Inspection Details"),12,"bold"),l=d(a(e.standardSections.inspectionIntroduction||""),10,"normal",8),l=d(a(e.standardSections.inspectionSpecifics||""),10,"normal",8),l=d(a(e.standardSections.tableIntroduction||""),10,"normal",8),l=d("Sample Inspection Results:",10,"bold",4);[["Area","Material Type","Condition","Result"],["Kitchen","Vinyl Floor Tiles","Good","Pass"],["Bathroom","Vinyl Floor Tiles","Good","Pass"],["Living Room","Vinyl Floor Tiles","Good","Pass"]].forEach(((e,t)=>{const a=0===t,n=a?"bold":"normal",r=a?10:9,s=[40,50,40,30];let i=c;e.forEach(((e,t)=>{o.setFontSize(r),o.setFont("helvetica",n),o.text(e,i,l,{maxWidth:s[t]}),i+=s[t]+5})),l+=1.2*r+2})),l+=10,l>s-100&&(o.addPage(),l=c),l=p(a(e.standardSections.clearanceCertificationTitle||"Clearance Certification"),12,"bold"),l=d(a(e.standardSections.clearanceCertificationText||""),10,"normal",8),l=d(a(e.standardSections.riskAssessmentText||""),10,"normal",8),l=d(a(e.standardSections.contactText||""),10,"normal",8),l=d(a(e.standardSections.behalfText||""),10,"normal",8),l=d(a(e.standardSections.signatureTitle||""),10,"bold",8),l>s-100&&(o.addPage(),l=c),l=p(a(e.standardSections.backgroundTitle||"Background Information"),12,"bold"),l=d(a(e.standardSections.backgroundIntroduction||""),10,"normal",8),l=d("\u2022 ".concat(a(e.standardSections.bulletPoint1||"")),10,"normal",4),l=d("\u2022 ".concat(a(e.standardSections.bulletPoint2||"")),10,"normal",4),l=d(a(e.standardSections.requirementsText||""),10,"normal",8),l=d("\u2022 ".concat(a(e.standardSections.bulletPoint3||"")),10,"normal",4),l=d("\u2022 ".concat(a(e.standardSections.bulletPoint4||"")),10,"normal",4),l=d("\u2022 ".concat(a(e.standardSections.bulletPoint5||"")),10,"normal",4),l>s-100&&(o.addPage(),l=c),l=p(a(e.standardSections.legislativeTitle||"Legislative Requirements"),12,"bold"),l=d(a(e.standardSections.legislativeIntroduction||""),10,"normal",8),l=d("\u2022 ".concat(a(e.standardSections.legislativePoint1||"")),10,"normal",4),l=d("\u2022 ".concat(a(e.standardSections.legislativePoint2||"")),10,"normal",4),l=d("\u2022 ".concat(a(e.standardSections.legislativePoint3||"")),10,"normal",4),l=p(a(e.standardSections.limitationsTitle||"Limitations"),12,"bold"),l=d(a(e.standardSections.limitationsText||""),10,"normal",8),l>s-150&&(o.addPage(),l=c),l=p("Authorised Signature",12,"bold"),l+=20,o.setLineWidth(.5),o.line(c,l,100,l),l+=5,l=d("Name: John Smith",10,"normal",4),l=d("License: AI000456",10,"normal",4),l=d("Date: 25 July 2024",10,"normal",4),l+=20,l=d(a(e.standardSections.footerText||""),9,"normal",8);const h="asbestos-clearance-template-preview-".concat((new Date).toISOString().split("T")[0],".pdf");return o.save(h),h},r=async(e,t)=>s(e,t),s=async(e,t)=>{try{var a;console.log("Starting server-side PDF generation with data:",t);const e="".concat("https://landd-app-backend1.onrender.com/api","/pdf/generate-asbestos-clearance?t=").concat(Date.now());console.log("Calling backend URL:",e);const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")),"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},body:JSON.stringify({clearanceData:t})});if(console.log("Response status:",n.status),console.log("Response headers:",Object.fromEntries(n.headers.entries())),!n.ok){const e=await n.json();throw new Error(e.error||"Failed to generate PDF")}const o=await n.blob();console.log("PDF blob size:",o.size,"bytes");const r=window.URL.createObjectURL(o),s=document.createElement("a");s.href=r;const c="asbestos-clearance-".concat((null===(a=t.projectId)||void 0===a?void 0:a.name)||"report","-").concat((new Date).toISOString().split("T")[0],".pdf");return s.download=c,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(r),console.log("PDF generation completed successfully:",c),c}catch(n){throw console.error("Error generating HTML template PDF:",n),console.error("Error stack:",n.stack),n}}},45360:(e,t,a)=>{a.d(t,{A:()=>s});var n=a(89379),o=a(82431);const r="/asbestos-clearances",s={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await o.A.get(r,{params:e})).data},getById:async e=>(await o.A.get("".concat(r,"/").concat(e))).data,create:async e=>(await o.A.post(r,e)).data,update:async(e,t)=>(await o.A.put("".concat(r,"/").concat(e),t)).data,delete:async e=>(await o.A.delete("".concat(r,"/").concat(e))).data,updateStatus:async(e,t)=>(await o.A.patch("".concat(r,"/").concat(e,"/status"),{status:t})).data,getStats:async()=>(await o.A.get("".concat(r,"/stats/overview"))).data,search:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=(0,n.A)({search:e},t);return(await o.A.get(r,{params:a})).data},getByStatus:async e=>(await o.A.get(r,{params:{status:e}})).data,getByRemovalist:async e=>(await o.A.get(r,{params:{asbestosRemovalist:e}})).data,uploadAirMonitoringReport:async(e,t)=>(await o.A.post("".concat(r,"/").concat(e,"/air-monitoring-report"),t)).data,getItems:async e=>(await o.A.get("".concat(r,"/").concat(e,"/items"))).data,addItem:async(e,t)=>(await o.A.post("".concat(r,"/").concat(e,"/items"),t)).data,updateItem:async(e,t,a)=>(await o.A.put("".concat(r,"/").concat(e,"/items/").concat(t),a)).data,deleteItem:async(e,t)=>(await o.A.delete("".concat(r,"/").concat(e,"/items/").concat(t))).data,getAirMonitoringReports:async e=>(await o.A.get("".concat(r,"/air-monitoring-reports/").concat(e))).data}},47968:(e,t,a)=>{a.d(t,{A:()=>r});var n=a(59662),o=a(70579);const r=(0,n.A)((0,o.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download")},56168:(e,t,a)=>{a.r(t),a.d(t,{default:()=>z});var n=a(65043),o=a(73216),r=a(96446),s=a(85865),c=a(63336),i=a(15795),l=a(51787),d=a(17392),p=a(11906),h=a(81637),g=a(79650),m=a(71806),A=a(84882),u=a(28076),y=a(10039),j=a(73460),x=a(43845),v=a(67254),b=a(77739),w=a(59662),S=a(70579);const f=(0,w.A)((0,S.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),I=(0,w.A)((0,S.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");var P=a(3632),R=a(47968),T=a(30513),C=a(26240),B=a(63777),D=a(76961),k=(a(32058),a(94505)),F=a(94257);const z=()=>{(0,C.A)(),B.LU;const[e,t]=(0,n.useState)(""),[w,z]=(0,n.useState)([]),[_,L]=(0,n.useState)(null),[M,E]=(0,n.useState)([]),[N,H]=(0,n.useState)(!1),[O,U]=(0,n.useState)(!1),[W,V]=(0,n.useState)(!1),[G,J]=(0,n.useState)(""),[q,K]=(0,n.useState)(new Set),Z=((0,o.Zp)(),async function(){const t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:e)||e;if(t.trim())try{var a;U(!0),J(""),z([]),L(null),E([]);const n={page:1,limit:1e3,sortBy:"projectID",sortOrder:"desc",search:t.trim()};n.limit=parseInt(n.limit),console.log("Search params:",n),console.log("Current searchTerm:",e),console.log("Search term being used:",t.trim());const o=await D.A.getAll(n);console.log("Search response:",o);const r=Array.isArray(o.data)?o.data:(null===(a=o.data)||void 0===a?void 0:a.data)||[];console.log("Projects data:",r.length),z(r);const s=new Set;r.forEach((e=>{e.reports_present&&s.add(e._id)})),K(s),0===r.length&&J("No projects found matching your search term")}catch(n){console.error("Error searching projects:",n),J("Failed to search projects"),z([])}finally{U(!1)}else J("Please enter a search term")}),$=e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"complete":return"success";case"in progress":return"warning";case"pending":return"info";default:return"default"}};return(0,S.jsxs)(r.A,{sx:{p:3},children:[(0,S.jsx)(s.A,{variant:"h4",component:"h1",gutterBottom:!0,sx:{mb:4},children:"Reports"}),(0,S.jsxs)(c.A,{sx:{p:3,mb:3},children:[(0,S.jsx)(s.A,{variant:"h6",gutterBottom:!0,children:"Search Projects"}),(0,S.jsxs)(r.A,{sx:{display:"flex",gap:2,alignItems:"flex-start",mb:2},children:[(0,S.jsx)(i.A,{fullWidth:!0,label:"Search for a project",placeholder:"Enter project ID, name, or client",value:e,onChange:e=>t(e.target.value),onKeyPress:t=>{"Enter"===t.key&&Z(e)},InputProps:{startAdornment:(0,S.jsx)(f,{sx:{mr:1,color:"text.secondary"}}),endAdornment:e&&(0,S.jsx)(l.A,{position:"end",children:(0,S.jsx)(d.A,{size:"small",onClick:()=>{t(""),z([]),L(null),E([]),J(""),K(new Set)},edge:"end",children:(0,S.jsx)(I,{})})})}}),(0,S.jsx)(p.A,{variant:"contained",onClick:()=>Z(e),disabled:!e.trim()||O,sx:{minWidth:140},children:O?(0,S.jsx)(h.A,{size:20,color:"inherit"}):"Search"})]}),w.length>0&&(0,S.jsxs)(r.A,{sx:{mt:2},children:[(0,S.jsxs)(s.A,{variant:"subtitle1",gutterBottom:!0,children:["Search Results (",w.length," projects found)"]}),(0,S.jsx)(g.A,{component:c.A,sx:{maxHeight:700},children:(0,S.jsxs)(m.A,{size:"small",children:[(0,S.jsx)(A.A,{children:(0,S.jsxs)(u.A,{children:[(0,S.jsx)(y.A,{children:"Project ID"}),(0,S.jsx)(y.A,{children:"Site Name"}),(0,S.jsx)(y.A,{children:"Reports"}),(0,S.jsx)(y.A,{align:"center",children:"Action"})]})}),(0,S.jsx)(j.A,{children:w.map((e=>{const t=q.has(e._id);return(0,S.jsxs)(u.A,{children:[(0,S.jsx)(y.A,{children:(0,S.jsx)(s.A,{variant:"body2",fontWeight:"medium",children:e.projectID})}),(0,S.jsx)(y.A,{children:e.name}),(0,S.jsx)(y.A,{children:(0,S.jsx)(x.A,{label:t?"Reports Available":"No Reports",color:t?"success":"error",size:"small"})}),(0,S.jsx)(y.A,{align:"center",children:(0,S.jsx)(p.A,{variant:"contained",size:"small",color:"secondary",disabled:!t,onClick:()=>window.location.href="/reports/project/".concat(e._id),children:"Load Reports"})})]},e._id)}))})]})})]})]}),G&&(0,S.jsx)(v.A,{severity:"error",sx:{mb:3},children:G}),M.length>0&&(0,S.jsxs)(c.A,{sx:{p:3},children:[(0,S.jsxs)(s.A,{variant:"h6",gutterBottom:!0,children:["Reports for ",null===_||void 0===_?void 0:_.projectID]}),(0,S.jsx)(g.A,{children:(0,S.jsxs)(m.A,{children:[(0,S.jsx)(A.A,{children:(0,S.jsxs)(u.A,{children:[(0,S.jsx)(y.A,{children:"Date"}),(0,S.jsx)(y.A,{children:"Report Type"}),(0,S.jsx)(y.A,{children:"Status"}),(0,S.jsx)(y.A,{align:"center",children:"Actions"})]})}),(0,S.jsx)(j.A,{children:M.map((e=>(0,S.jsxs)(u.A,{children:[(0,S.jsx)(y.A,{children:e.date.toLocaleDateString()}),(0,S.jsxs)(y.A,{children:[(0,S.jsx)(s.A,{variant:"body2",fontWeight:"medium",children:e.type}),e.jobName&&(0,S.jsxs)(s.A,{variant:"caption",color:"text.secondary",children:[e.jobName," \u2022 ",e.shiftName]})]}),(0,S.jsx)(y.A,{children:(0,S.jsx)(x.A,{label:e.status,color:$(e.status),size:"small"})}),(0,S.jsx)(y.A,{align:"center",children:(0,S.jsxs)(r.A,{sx:{display:"flex",gap:1,justifyContent:"center"},children:[(0,S.jsx)(b.A,{title:"View Report",children:(0,S.jsx)(d.A,{size:"small",onClick:()=>(async e=>{try{if("Air Monitoring Report"===e.type){var t;const a=e.report,n=await k.jobService.getById((null===(t=a.job)||void 0===t?void 0:t._id)||a.job),o=await k.sampleService.getByShift(a._id),r=await Promise.all(o.data.map((async e=>e.analysis?e:(await k.sampleService.getById(e._id)).data)));let s=n.data.project;if(s&&"string"===typeof s&&(s=(await D.A.getById(s)).data),s&&s.client&&"string"===typeof s.client){const e=await k.clientService.getById(s.client);s.client=e.data}(0,F.generateShiftReport)({shift:a,job:n.data,samples:r,project:s,openInNewTab:!0})}else if("Asbestos Clearance Report"===e.type){const t=e.report,n="object"===typeof t.clearanceId?t.clearanceId._id:t.clearanceId,o=a(82431).A,r=await o.post("/pdf/generate-asbestos-clearance",{clearanceData:{_id:n}},{responseType:"blob"}),s=new Blob([r.data],{type:"application/pdf"}),c=window.URL.createObjectURL(s);window.open(c,"_blank"),console.log("Asbestos clearance PDF opened in browser")}}catch(n){console.error("Error viewing report:",n),J("Failed to view report")}})(e),color:"primary",children:(0,S.jsx)(P.A,{})})}),(0,S.jsx)(b.A,{title:"Download Report",children:(0,S.jsx)(d.A,{size:"small",onClick:()=>(async e=>{try{if("Air Monitoring Report"===e.type){var t;const a=e.report,n=await k.jobService.getById((null===(t=a.job)||void 0===t?void 0:t._id)||a.job),o=await k.sampleService.getByShift(a._id),r=await Promise.all(o.data.map((async e=>e.analysis?e:(await k.sampleService.getById(e._id)).data)));let s=n.data.project;if(s&&"string"===typeof s&&(s=(await D.A.getById(s)).data),s&&s.client&&"string"===typeof s.client){const e=await k.clientService.getById(s.client);s.client=e.data}(0,F.generateShiftReport)({shift:a,job:n.data,samples:r,project:s,openInNewTab:!1})}else if("Asbestos Clearance Report"===e.type){const t=e.report,n=a(45360).A,o="object"===typeof t.clearanceId?t.clearanceId._id:t.clearanceId,r=await n.getById(o),{generateHTMLTemplatePDF:s}=a(43381),c=await s("asbestos-clearance",r);console.log("Asbestos clearance PDF downloaded successfully:",c)}}catch(n){console.error("Error downloading report:",n),J("Failed to download report")}})(e),color:"secondary",children:(0,S.jsx)(R.A,{})})}),(0,S.jsx)(b.A,{title:"Print Report",children:(0,S.jsx)(d.A,{size:"small",onClick:()=>(async e=>{try{if("Air Monitoring Report"===e.type){var t;const a=e.report,n=await k.jobService.getById((null===(t=a.job)||void 0===t?void 0:t._id)||a.job),o=await k.sampleService.getByShift(a._id),r=await Promise.all(o.data.map((async e=>e.analysis?e:(await k.sampleService.getById(e._id)).data)));let s=n.data.project;if(s&&"string"===typeof s&&(s=(await D.A.getById(s)).data),s&&s.client&&"string"===typeof s.client){const e=await k.clientService.getById(s.client);s.client=e.data}(0,F.generateShiftReport)({shift:a,job:n.data,samples:r,project:s,openInNewTab:!0}),setTimeout((()=>{window.print()}),1e3)}else"Asbestos Clearance Report"===e.type&&console.log("Printing asbestos clearance report:",e)}catch(a){console.error("Error printing report:",a),J("Failed to print report")}})(e),color:"info",children:(0,S.jsx)(T.A,{})})})]})})]},e.id)))})]})})]}),_&&!W&&0===M.length&&!G&&(0,S.jsxs)(c.A,{sx:{p:3,textAlign:"center"},children:[(0,S.jsx)(s.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Reports Found"}),(0,S.jsx)(s.A,{variant:"body2",color:"text.secondary",children:"No reports have been generated for this project yet."})]})]})}},76961:(e,t,a)=>{a.d(t,{A:()=>o});var n=a(82431);const o={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await n.A.get("/projects",{params:e})).data},getById:e=>n.A.get("/projects/".concat(e)),create:e=>n.A.post("/projects",e),update:(e,t)=>n.A.put("/projects/".concat(e),t),delete:e=>n.A.delete("/projects/".concat(e))}}}]);
//# sourceMappingURL=168.0d4b1f1f.chunk.js.map