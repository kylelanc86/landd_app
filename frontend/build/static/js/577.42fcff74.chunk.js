"use strict";(self.webpackChunkair_monitoring_frontend=self.webpackChunkair_monitoring_frontend||[]).push([[577],{37577:(e,t,a)=>{a.r(t),a.d(t,{default:()=>_});var s=a(65043),i=a(26240),n=a(85865),o=a(96446),r=a(11906),l=a(15795),c=a(88911),d=a(51787),u=a(79650),m=a(63336),p=a(71806),h=a(84882),x=a(28076),A=a(10039),f=a(73460),v=a(17392),g=a(73216),j=a(66360),b=a(22505),k=a(69120),y=a(63471),S=a(94505),w=a(21291),C=a(70579);const _=()=>{const e=(0,i.A)(),{shiftId:t}=(0,g.g)(),a=(0,g.Zp)(),[_,I]=(0,s.useState)([]),[T,D]=(0,s.useState)(""),[E,F]=(0,s.useState)("sampleNumber"),[L,N]=(0,s.useState)(!0),[B,O]=(0,s.useState)(null),[P,W]=(0,s.useState)(!0),[R,q]=(0,s.useState)(null),[M,$]=(0,s.useState)(!0),[U,Y]=(0,s.useState)(null),[z,Z]=(0,s.useState)(""),[G,H]=(0,s.useState)("");(0,s.useEffect)((()=>{(async()=>{try{var e,a,s,i;W(!0);const n=await S.sA.getById(t);O(n.data);const o=await S.kw.getByShift(t);I(o.data||[]);const r=null===(e=n.data)||void 0===e||null===(a=e.job)||void 0===a||null===(s=a.project)||void 0===s?void 0:s.projectID;if(r){const e=await S.kw.getByProject(r),t=(e.data||[]).reduce(((e,t)=>{var a;const s=null===(a=t.fullSampleID)||void 0===a?void 0:a.match(/-(\d+)$/),i=s?parseInt(s[1]):0;return Math.max(e,i)}),0);Y(t+1)}null!==(i=n.data)&&void 0!==i&&i.descriptionOfWorks&&Z(n.data.descriptionOfWorks),$(!Q(_)),q(null)}catch(n){console.error("Error fetching data:",n),q("Failed to load data. Please try again later.")}finally{W(!1)}})()}),[t]);const J=e=>{e===E?N(!L):(F(e),N(!0))},K=[..._.filter((e=>Object.values(e).some((e=>e&&e.toString().toLowerCase().includes(T.toLowerCase())))))].sort(((e,t)=>{if("sampleNumber"===E||"fullSampleID"===E){var a,s;const i=null===(a=e.fullSampleID)||void 0===a?void 0:a.match(/-(\d+)$/),n=null===(s=t.fullSampleID)||void 0===s?void 0:s.match(/-(\d+)$/),o=i?parseInt(i[1],10):0,r=n?parseInt(n[1],10):0;return L?o-r:r-o}{const a=e[E],s=t[E];return a<s?L?-1:1:a>s?L?1:-1:0}})),Q=e=>e.every((e=>"Field blank"===e.location||e.sampleNumber&&e.type&&e.location&&e.startTime&&e.endTime&&e.initialFlowrate&&e.finalFlowrate&&e.averageFlowrate));return P?(0,C.jsx)(n.A,{children:"Loading..."}):R?(0,C.jsx)(n.A,{color:"error",children:R}):(0,C.jsxs)(o.A,{sx:{p:{xs:2,sm:3,md:4}},children:[(0,C.jsx)(r.A,{startIcon:(0,C.jsx)(k.A,{}),onClick:()=>{var e;return a("/air-monitoring/jobs/".concat(null===B||void 0===B||null===(e=B.job)||void 0===e?void 0:e._id,"/shifts"))},sx:{mb:4},children:"Back to Shifts"}),(0,C.jsxs)(o.A,{sx:{mb:3},children:[(0,C.jsx)(n.A,{variant:"h6",sx:{mb:1},children:"Description of Works"}),(0,C.jsx)(l.A,{fullWidth:!0,multiline:!0,minRows:2,maxRows:6,value:z,onChange:e=>{Z(e.target.value),H("")},placeholder:"Enter a description of works for this shift...",required:!0,error:!z,helperText:z?"":"Description of works is required"}),(0,C.jsxs)(o.A,{sx:{mt:1,display:"flex",alignItems:"center",gap:2},children:[(0,C.jsx)(r.A,{variant:"contained",onClick:async()=>{try{await S.sA.update(t,{descriptionOfWorks:z}),H("Saved")}catch(e){H("Error")}},disabled:!z.trim(),sx:{backgroundColor:e.palette.primary.main,"&:hover":{backgroundColor:e.palette.primary.dark}},children:"Save Description"}),"Saved"===G&&(0,C.jsx)(n.A,{variant:"caption",color:"success.main",children:"Description saved successfully"}),"Error"===G&&(0,C.jsx)(n.A,{variant:"caption",color:"error.main",children:"Error saving description"})]})]}),(0,C.jsxs)(n.A,{variant:"h4",sx:{color:"dark"===e.palette.mode?"#fff":e.palette.secondary[200],mb:4},children:["Samples for"," ",null!==B&&void 0!==B&&B.name?"Shift ".concat((0,w.Yq)(B.date)):"Loading..."]}),(0,C.jsxs)(c.A,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:4},justifyContent:"space-between",alignItems:"center",children:[(0,C.jsx)(l.A,{label:"Search",variant:"outlined",value:T,onChange:e=>{D(e.target.value)},sx:{width:{xs:"100%",sm:"300px"}},InputProps:{startAdornment:(0,C.jsx)(d.A,{position:"start",children:(0,C.jsx)(j.A,{})})}}),(0,C.jsx)(r.A,{variant:"contained",startIcon:(0,C.jsx)(b.A,{}),onClick:()=>{S.sA.update(t,{status:"ongoing"}),a("/air-monitoring/shift/".concat(t,"/samples/new"),{state:{nextSampleNumber:U}})},sx:{backgroundColor:e.palette.primary.main,"&:hover":{backgroundColor:e.palette.primary.dark}},children:"Add Sample"})]}),(0,C.jsx)(u.A,{component:m.A,children:(0,C.jsxs)(p.A,{children:[(0,C.jsx)(h.A,{children:(0,C.jsxs)(x.A,{children:[(0,C.jsx)(A.A,{onClick:()=>J("sampleNumber"),children:"Sample Number"}),(0,C.jsx)(A.A,{onClick:()=>J("type"),children:"Type"}),(0,C.jsx)(A.A,{onClick:()=>J("location"),children:"Location"}),(0,C.jsx)(A.A,{onClick:()=>J("startTime"),children:"Start Time"}),(0,C.jsx)(A.A,{onClick:()=>J("endTime"),children:"End Time"}),(0,C.jsx)(A.A,{onClick:()=>J("averageFlowrate"),children:"Flow Rate (L/min)"}),(0,C.jsx)(A.A,{children:"Actions"})]})}),(0,C.jsx)(f.A,{children:K.map((e=>(0,C.jsxs)(x.A,{children:[(0,C.jsx)(A.A,{children:e.fullSampleID}),(0,C.jsx)(A.A,{children:e.type}),(0,C.jsx)(A.A,{children:e.location}),(0,C.jsx)(A.A,{children:(0,w.fU)(e.startTime)}),(0,C.jsx)(A.A,{children:e.endTime?(0,w.fU)(e.endTime):"-"}),(0,C.jsx)(A.A,{children:e.averageFlowrate}),(0,C.jsxs)(A.A,{children:[(0,C.jsx)(r.A,{variant:"outlined",size:"small",onClick:()=>a("/air-monitoring/shift/".concat(t,"/samples/edit/").concat(e._id)),sx:{mr:1},children:"Edit Sample"}),(0,C.jsx)(v.A,{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this sample?"))try{await S.kw.delete(e),I(_.filter((t=>t._id!==e)))}catch(t){console.error("Error deleting sample:",t),q("Failed to delete sample. Please try again.")}})(e._id),children:(0,C.jsx)(y.A,{})})]})]},e._id)))})]})}),(0,C.jsxs)(o.A,{sx:{display:"flex",justifyContent:"flex-end",mt:2,gap:2},children:[!["sampling_complete","samples_submitted_to_lab","analysis_complete","shift_complete"].includes(null===B||void 0===B?void 0:B.status)&&(0,C.jsx)(r.A,{variant:"contained",color:"primary",onClick:async()=>{try{await S.sA.update(t,{status:"sampling_complete"});const e=await S.sA.getById(t);O(e.data)}catch(R){console.error("Error updating shift status:",R),q("Failed to update shift status. Please try again.")}},disabled:M||"ongoing"!==(null===B||void 0===B?void 0:B.status),sx:{backgroundColor:e.palette.info.main,color:e.palette.info.contrastText,"&:hover":{backgroundColor:e.palette.info.dark},"&.Mui-disabled":{backgroundColor:e.palette.grey[700],color:e.palette.grey[500]}},children:"Sampling Complete"}),!["samples_submitted_to_lab","analysis_complete","shift_complete"].includes(null===B||void 0===B?void 0:B.status)&&"sampling_complete"===(null===B||void 0===B?void 0:B.status)&&(0,C.jsx)(r.A,{variant:"contained",color:"secondary",onClick:async()=>{try{const e=(new Date).toISOString();await S.sA.update(t,{status:"samples_submitted_to_lab",samplesReceivedDate:e});const a=await S.sA.getById(t);O(a.data)}catch(R){q("Failed to update shift status to 'Samples Submitted to Lab'.")}},sx:{backgroundColor:e.palette.warning.main,color:e.palette.warning.contrastText,"&:hover":{backgroundColor:e.palette.warning.dark}},children:"Samples Submitted to Lab"})]}),["samples_submitted_to_lab","analysis_complete"].includes(null===B||void 0===B?void 0:B.status)&&(0,C.jsx)(o.A,{sx:{display:"flex",justifyContent:"flex-end",mt:3},children:(0,C.jsx)(r.A,{variant:"contained",onClick:()=>a("/air-monitoring/shift/".concat(t,"/analysis")),sx:{backgroundColor:e.palette.success.main,color:e.palette.success.contrastText,"&:hover":{backgroundColor:e.palette.success.dark}},children:"COMPLETE ANALYSIS"})})]})}}}]);
//# sourceMappingURL=577.42fcff74.chunk.js.map