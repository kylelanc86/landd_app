"use strict";(self.webpackChunkair_monitoring_frontend=self.webpackChunkair_monitoring_frontend||[]).push([[562],{20562:(e,t,n)=>{n.r(t),n.d(t,{default:()=>H});var a=n(89379),r=n(65043),o=n(26240),l=n(85865),i=n(96446),c=n(17392),s=n(11906),d=n(88911),m=n(15795),u=n(51787),h=n(41020),x=n(39336),f=n(35721),b=n(30681),p=n(38968),g=n(2050),A=n(51962),C=n(48734),v=n(90035),j=n(26600),N=n(35316),y=n(29347),w=n(98533),E=n(21268),S=n(1019),k=n(94505),W=n(73216),_=(n(37660),n(63777),n(22505)),F=n(95540),P=n(63471),D=n(66360),I=n(4721),z=n(28499),M=n(19778);const T=e=>{if(!e)return"";const t=e.replace(/\D/g,"");return 10===t.length&&t.startsWith("04")?"".concat(t.slice(0,4)," ").concat(t.slice(4,7)," ").concat(t.slice(7)):t},q=e=>{if(!e)return!1;const t=e.replace(/\D/g,"");return 10===t.length&&t.startsWith("04")};var O=n(53536),G=n(70579);const R={name:"",invoiceEmail:"",address:"",contact1Name:"",contact1Number:"",contact1Email:"",contact2Name:"",contact2Number:"",contact2Email:"",written_off:!1},V=()=>{console.log("Clients component rendering");const e=(0,o.A)(),t=(0,W.Zp)(),[n,V]=(0,r.useState)([]),[H,B]=(0,r.useState)(!0),[U,J]=(0,r.useState)(null),[L,Z]=(0,r.useState)(!1),[K,Q]=(0,r.useState)(!1),[X,Y]=(0,r.useState)(R),[$,ee]=(0,r.useState)(R),[te,ne]=(0,r.useState)(null),[ae,re]=(0,r.useState)(!1),[oe,le]=(0,r.useState)(null),[ie,ce]=(0,r.useState)(""),[se,de]=(0,r.useState)(""),[me,ue]=(0,r.useState)({page:1,limit:25,total:0,pages:0}),he=(0,r.useRef)(null),[xe,fe]=(0,r.useState)({name:!0,invoiceEmail:!0,contact1Name:!0,contact1Number:!0,address:!1,written_off:!0,actions:!0}),[be,pe]=(0,r.useState)(null);(0,r.useEffect)((()=>{(async()=>{try{var e,t;const n=await k.Tc.getPreferences();null!==(e=n.data)&&void 0!==e&&null!==(t=e.columnVisibility)&&void 0!==t&&t.clients&&fe(n.data.columnVisibility.clients)}catch(U){console.error("Error loading user preferences:",U);const t=localStorage.getItem("clients-column-visibility");if(t)try{const e=JSON.parse(t);fe(e)}catch(n){console.error("Error parsing saved column visibility:",n)}}})()}),[]),(0,r.useEffect)((()=>(console.log("Clients component mounted"),()=>console.log("Clients component unmounted"))),[]),(0,r.useEffect)((()=>{console.log("Search state changed:",{searchInput:ie,search:se})}),[ie,se]),(0,r.useEffect)((()=>{console.log("Pagination state changed:",me)}),[me]);const ge=(0,r.useCallback)((0,O.debounce)((e=>{de(e),ue((e=>(0,a.A)((0,a.A)({},e),{},{page:1})))}),300),[]),Ae=(0,r.useCallback)((e=>{const t=e.target.value;ce(t),ge(t)}),[ge]),Ce=((0,r.useCallback)((e=>{e.preventDefault(),e.stopPropagation()}),[]),(0,r.useCallback)((async()=>{try{B(!0);const e=await k.clientService.getAll({page:me.page,limit:me.limit,search:se});V(e.data.clients||e.data),ue((t=>{var n,r,o,l;return(0,a.A)((0,a.A)({},t),{},{total:(null===(n=e.data.pagination)||void 0===n?void 0:n.total)||(null===(r=e.pagination)||void 0===r?void 0:r.total)||0,pages:(null===(o=e.data.pagination)||void 0===o?void 0:o.pages)||(null===(l=e.pagination)||void 0===l?void 0:l.pages)||0})}))}catch(e){console.error("Error fetching clients:",e),J(e.message)}finally{B(!1)}}),[me.page,me.limit,se]));(0,r.useEffect)((()=>{Ce()}),[Ce]),(0,r.useEffect)((()=>{!H&&he.current&&he.current.focus()}),[H]);const ve=(0,r.useCallback)((e=>{ue((t=>(0,a.A)((0,a.A)({},t),{},{page:e})))}),[]),je=(0,r.useCallback)((e=>{ue((t=>(0,a.A)((0,a.A)({},t),{},{limit:e,page:1})))}),[]),Ne=e=>{const{name:t,value:n}=e.target;Y("contact1Number"===t||"contact2Number"===t?(0,a.A)((0,a.A)({},X),{},{[t]:T(n)}):(0,a.A)((0,a.A)({},X),{},{[t]:n}))},ye=e=>{const{name:t,value:n}=e.target;ee("contact1Number"===t||"contact2Number"===t?(0,a.A)((0,a.A)({},$),{},{[t]:T(n)}):(0,a.A)((0,a.A)({},$),{},{[t]:n}))},we=[{field:"name",headerName:"Client Name",flex:1,renderCell:e=>(0,G.jsx)(l.A,{sx:{color:e.row.written_off?"red":"inherit",fontWeight:e.row.written_off?"bold":"normal",fontSize:"0.875rem"},children:e.row.name})},{field:"invoiceEmail",headerName:"Invoice Email",flex:1,renderCell:e=>(0,G.jsx)(l.A,{sx:{color:e.row.written_off?"red":"inherit",fontWeight:e.row.written_off?"bold":"normal",fontSize:"0.875rem"},children:e.row.invoiceEmail})},{field:"contact1Name",headerName:"Primary Contact",flex:1,renderCell:e=>(0,G.jsx)(l.A,{sx:{color:e.row.written_off?"red":"inherit",fontWeight:e.row.written_off?"bold":"normal",fontSize:"0.875rem"},children:e.row.contact1Name})},{field:"contact1Number",headerName:"Primary Phone",flex:1,valueGetter:e=>T(e.row.contact1Number),renderCell:e=>(0,G.jsx)(l.A,{sx:{color:e.row.written_off?"red":"inherit",fontWeight:e.row.written_off?"bold":"normal",fontSize:"0.875rem"},children:T(e.row.contact1Number)})},{field:"address",headerName:"Address",flex:1,renderCell:e=>(0,G.jsx)(l.A,{sx:{color:e.row.written_off?"red":"inherit",fontWeight:e.row.written_off?"bold":"normal",fontSize:"0.875rem"},children:e.row.address})},{field:"written_off",headerName:"Written Off",flex:.5,renderCell:e=>(0,G.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:e.row.written_off&&(0,G.jsx)(M.A,{sx:{color:"red",fontSize:20}})})},{field:"actions",headerName:"Actions",flex:1,renderCell:e=>(0,G.jsxs)(i.A,{children:[(0,G.jsx)(c.A,{onClick:()=>t("/invoices?client=".concat(e.row._id)),title:"View Invoices",children:(0,G.jsx)(I.A,{})}),(0,G.jsx)(c.A,{onClick:()=>{return t=e.row,ee({name:t.name,invoiceEmail:t.invoiceEmail,address:t.address,contact1Name:t.contact1Name,contact1Number:t.contact1Number,contact1Email:t.contact1Email,contact2Name:t.contact2Name||"",contact2Number:t.contact2Number||"",contact2Email:t.contact2Email||"",written_off:t.written_off||!1}),ne(t._id),void Q(!0);var t},title:"Edit Client",children:(0,G.jsx)(F.A,{})}),(0,G.jsx)(c.A,{onClick:()=>{return t=e.row,le(t),void re(!0);var t},title:"Delete Client",color:"error",children:(0,G.jsx)(P.A,{})})]})}];return H?(0,G.jsx)(l.A,{children:"Loading clients..."}):U?(0,G.jsx)(l.A,{color:"error",children:U}):(0,G.jsxs)(i.A,{m:"20px",children:[(0,G.jsx)(i.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:(0,G.jsxs)(s.A,{variant:"contained",color:"secondary",onClick:()=>Z(!0),sx:{backgroundColor:e.palette.secondary.main,"&:hover":{backgroundColor:e.palette.secondary.dark}},children:[(0,G.jsx)(_.A,{sx:{mr:1}}),"Add Client"]})}),(0,G.jsx)(i.A,{mt:"20px",mb:"20px",sx:{backgroundColor:"background.paper",borderRadius:"4px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)",p:2},children:(0,G.jsxs)(d.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,G.jsx)(m.A,{inputRef:he,label:"Search by Client Name",value:ie,onChange:Ae,sx:{flex:1},InputProps:{startAdornment:(0,G.jsx)(u.A,{position:"start",children:(0,G.jsx)(D.A,{})})}}),(0,G.jsx)(s.A,{variant:"outlined",size:"small",startIcon:(0,G.jsx)(z.A,{}),onClick:e=>{pe(e.currentTarget)},sx:{height:56,minWidth:140,color:e.palette.primary.main,borderColor:e.palette.primary.main,"&:hover":{backgroundColor:e.palette.primary.main,color:"white",borderColor:e.palette.primary.main}},children:"Columns"})]})}),(0,G.jsx)(h.Ay,{open:Boolean(be),anchorEl:be,onClose:()=>{pe(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{minWidth:200,maxHeight:400}},children:(0,G.jsxs)(i.A,{sx:{p:1},children:[(0,G.jsx)(l.A,{variant:"subtitle2",sx:{p:1,fontWeight:"bold"},children:"Show/Hide Columns"}),(0,G.jsx)(x.A,{sx:{mb:1}}),(0,G.jsx)(f.A,{dense:!0,children:we.map((e=>(0,G.jsx)(b.Ay,{disablePadding:!0,children:(0,G.jsxs)(p.A,{dense:!0,onClick:()=>(async e=>{const t=(0,a.A)((0,a.A)({},xe),{},{[e]:!xe[e]});fe(t);try{await k.Tc.updatePreferences({columnVisibility:{clients:t}})}catch(U){console.error("Error saving column visibility preferences:",U),localStorage.setItem("clients-column-visibility",JSON.stringify(t))}})(e.field),children:[(0,G.jsx)(g.A,{sx:{minWidth:36},children:(0,G.jsx)(A.A,{edge:"start",checked:!1!==xe[e.field],tabIndex:-1,disableRipple:!0,size:"small"})}),(0,G.jsx)(C.A,{primary:e.headerName,primaryTypographyProps:{fontSize:"0.875rem"}})]})},e.field)))})]})}),(0,G.jsx)(i.A,{m:"40px 0 0 0",height:"75vh",sx:{"& .MuiDataGrid-root":{border:"none"},"& .MuiDataGrid-cell":{borderBottom:"1px solid ".concat(e.palette.divider),fontSize:"0.875rem",color:"#000000"},"& .MuiDataGrid-columnHeaders":{backgroundColor:e.palette.primary.main,borderBottom:"none",fontSize:"0.875rem",color:"#FFFFFF"},"& .MuiDataGrid-columnHeader":{color:"#FFFFFF",fontWeight:600},"& .MuiDataGrid-virtualScroller":{backgroundColor:"#FFFFFF"},"& .MuiDataGrid-footerContainer":{borderTop:"none",backgroundColor:e.palette.primary.main,fontSize:"0.875rem",color:"#FFFFFF"},"& .MuiCheckbox-root":{color:"".concat(e.palette.secondary.main," !important")},"& .MuiDataGrid-row:nth-of-type(even)":{backgroundColor:"#f8f9fa"},"& .MuiDataGrid-row:nth-of-type(odd)":{backgroundColor:"#ffffff"},"& .MuiDataGrid-row:hover":{backgroundColor:"#e3f2fd"}},children:(0,G.jsx)(E.zh,{rows:n,columns:we,getRowId:e=>e._id,pageSize:me.limit,page:me.page-1,rowCount:me.total,onPageChange:ve,onPageSizeChange:je,paginationMode:"server",loading:H,autoHeight:!0,disableSelectionOnClick:!0,components:{Toolbar:S.O},keepNonExistentRowsSelected:!0,disableColumnMenu:!0,disableColumnFilter:!0,disableColumnSelector:!0,disableDensitySelector:!0,columnVisibilityModel:xe,onColumnVisibilityModelChange:fe})}),(0,G.jsxs)(v.A,{open:L,onClose:()=>Z(!1),maxWidth:"md",fullWidth:!0,children:[(0,G.jsx)(j.A,{children:"Create New Client"}),(0,G.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=await k.clientService.create(X);V([e.data,...n]),Z(!1),Y(R)}catch(t){t.response&&alert("Error creating client: ".concat(t.response.data.message||"Unknown error"))}},children:[(0,G.jsx)(N.A,{children:(0,G.jsxs)(d.A,{spacing:2,children:[(0,G.jsx)(m.A,{label:"Client Name",name:"name",value:X.name,onChange:Ne,required:!0,fullWidth:!0}),(0,G.jsx)(m.A,{label:"Invoice Email",name:"invoiceEmail",type:"email",value:X.invoiceEmail,onChange:Ne,required:!0,fullWidth:!0}),(0,G.jsx)(m.A,{label:"Address",name:"address",value:X.address,onChange:Ne,required:!0,fullWidth:!0}),(0,G.jsx)(l.A,{variant:"h6",sx:{mt:2},children:"Primary Contact"}),(0,G.jsx)(m.A,{label:"Contact Name",name:"contact1Name",value:X.contact1Name,onChange:Ne,required:!0,fullWidth:!0}),(0,G.jsx)(m.A,{label:"Contact Phone",name:"contact1Number",value:X.contact1Number,onChange:Ne,required:!0,fullWidth:!0,placeholder:"04xx xxx xxx",error:X.contact1Number&&!q(X.contact1Number),helperText:X.contact1Number&&!q(X.contact1Number)?"Please enter a valid Australian mobile number":""}),(0,G.jsx)(m.A,{label:"Contact Email",name:"contact1Email",type:"email",value:X.contact1Email,onChange:Ne,required:!0,fullWidth:!0}),(0,G.jsx)(l.A,{variant:"h6",sx:{mt:2},children:"Secondary Contact (Optional)"}),(0,G.jsx)(m.A,{label:"Contact Name",name:"contact2Name",value:X.contact2Name,onChange:Ne,fullWidth:!0}),(0,G.jsx)(m.A,{label:"Contact Phone",name:"contact2Number",value:X.contact2Number,onChange:Ne,fullWidth:!0,placeholder:"04xx xxx xxx",error:X.contact2Number&&!q(X.contact2Number),helperText:X.contact2Number&&!q(X.contact2Number)?"Please enter a valid Australian mobile number":""}),(0,G.jsx)(m.A,{label:"Contact Email",name:"contact2Email",type:"email",value:X.contact2Email,onChange:Ne,fullWidth:!0}),(0,G.jsxs)(i.A,{sx:{mt:2,display:"flex",alignItems:"center"},children:[(0,G.jsx)(A.A,{name:"written_off",checked:X.written_off,onChange:e=>Y((0,a.A)((0,a.A)({},X),{},{written_off:e.target.checked})),sx:{color:"red","&.Mui-checked":{color:"red"}}}),(0,G.jsx)(l.A,{variant:"body1",sx:{color:"red",fontWeight:"bold"},children:"WRITTEN OFF?"})]})]})}),(0,G.jsxs)(y.A,{children:[(0,G.jsx)(s.A,{onClick:()=>Z(!1),color:"secondary",children:"Cancel"}),(0,G.jsx)(s.A,{type:"submit",variant:"contained",color:"primary",children:"Create Client"})]})]})]}),(0,G.jsxs)(v.A,{open:K,onClose:()=>Q(!1),maxWidth:"md",fullWidth:!0,children:[(0,G.jsx)(j.A,{children:"Edit Client"}),(0,G.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=await k.clientService.update(te,$);V(n.map((t=>t._id===te?e.data:t))),Q(!1),ee(R),ne(null)}catch(t){t.response&&alert("Error updating client: ".concat(t.response.data.message||"Unknown error"))}},children:[(0,G.jsx)(N.A,{children:(0,G.jsxs)(d.A,{spacing:2,children:[(0,G.jsx)(m.A,{label:"Client Name",name:"name",value:$.name,onChange:ye,required:!0,fullWidth:!0}),(0,G.jsx)(m.A,{label:"Invoice Email",name:"invoiceEmail",type:"email",value:$.invoiceEmail,onChange:ye,required:!0,fullWidth:!0}),(0,G.jsx)(m.A,{label:"Address",name:"address",value:$.address,onChange:ye,required:!0,fullWidth:!0}),(0,G.jsx)(l.A,{variant:"h6",sx:{mt:2},children:"Primary Contact"}),(0,G.jsx)(m.A,{label:"Contact Name",name:"contact1Name",value:$.contact1Name,onChange:ye,required:!0,fullWidth:!0}),(0,G.jsx)(m.A,{label:"Contact Phone",name:"contact1Number",value:$.contact1Number,onChange:ye,required:!0,fullWidth:!0,placeholder:"04xx xxx xxx",error:$.contact1Number&&!q($.contact1Number),helperText:$.contact1Number&&!q($.contact1Number)?"Please enter a valid Australian mobile number":""}),(0,G.jsx)(m.A,{label:"Contact Email",name:"contact1Email",type:"email",value:$.contact1Email,onChange:ye,required:!0,fullWidth:!0}),(0,G.jsx)(l.A,{variant:"h6",sx:{mt:2},children:"Secondary Contact (Optional)"}),(0,G.jsx)(m.A,{label:"Contact Name",name:"contact2Name",value:$.contact2Name,onChange:ye,fullWidth:!0}),(0,G.jsx)(m.A,{label:"Contact Phone",name:"contact2Number",value:$.contact2Number,onChange:ye,fullWidth:!0,placeholder:"04xx xxx xxx",error:$.contact2Number&&!q($.contact2Number),helperText:$.contact2Number&&!q($.contact2Number)?"Please enter a valid Australian mobile number":""}),(0,G.jsx)(m.A,{label:"Contact Email",name:"contact2Email",type:"email",value:$.contact2Email,onChange:ye,fullWidth:!0}),(0,G.jsxs)(i.A,{sx:{mt:2,display:"flex",alignItems:"center"},children:[(0,G.jsx)(A.A,{name:"written_off",checked:$.written_off,onChange:e=>ee((0,a.A)((0,a.A)({},$),{},{written_off:e.target.checked})),sx:{color:"red","&.Mui-checked":{color:"red"}}}),(0,G.jsx)(l.A,{variant:"body1",sx:{color:"red",fontWeight:"bold"},children:"WRITTEN OFF?"})]})]})}),(0,G.jsxs)(y.A,{children:[(0,G.jsx)(i.A,{sx:{flex:"1"}}),(0,G.jsx)(s.A,{onClick:()=>Q(!1),color:"secondary",children:"Cancel"}),(0,G.jsx)(s.A,{type:"submit",variant:"contained",color:"primary",children:"Save Changes"})]})]})]}),(0,G.jsxs)(v.A,{open:ae,onClose:()=>re(!1),children:[(0,G.jsx)(j.A,{children:"Delete Client"}),(0,G.jsx)(N.A,{children:(0,G.jsxs)(w.A,{children:["Are you sure you want to delete ",null===oe||void 0===oe?void 0:oe.name,"? This action cannot be undone."]})}),(0,G.jsxs)(y.A,{children:[(0,G.jsx)(s.A,{onClick:()=>re(!1),color:"primary",children:"Cancel"}),(0,G.jsx)(s.A,{onClick:async()=>{try{await k.clientService.delete(oe._id),V(n.filter((e=>e._id!==oe._id))),re(!1),le(null),K&&(Q(!1),ee(R),ne(null))}catch(e){e.response&&alert("Error deleting client: ".concat(e.response.data.message||"Unknown error"))}},color:"error",variant:"contained",children:"Delete"})]})]})]})},H=(0,r.memo)(V)}}]);
//# sourceMappingURL=562.2919dd19.chunk.js.map