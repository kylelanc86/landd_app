"use strict";(self.webpackChunkair_monitoring_frontend=self.webpackChunkair_monitoring_frontend||[]).push([[212],{10105:(e,t,r)=>{r.d(t,{A:()=>s});r(65043);var a=r(96446),l=r(85865),n=r(77739),o=r(70579);const s=e=>{let{value:t,tooltip:r=!0}=e;if(!t)return null;const s=(0,o.jsx)(a.A,{sx:{width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(0,o.jsx)(l.A,{variant:"body2",noWrap:!0,children:t})});return r?(0,o.jsx)(n.A,{title:t,placement:"top",children:s}):s}},58212:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ae});var a=r(89379),l=r(65043),n=r(96446),o=r(77739),s=r(81045),i=r(53193),c=r(79190),d=r(72221),u=r(43845),m=r(32143),h=r(85865),p=r(11906),A=r(17392),x=r(39336),g=r(10611),j=r(88911),f=r(15795),v=r(51787),b=r(41020),C=r(35721),y=r(30681),S=r(38968),w=r(2050),k=r(51962),E=r(48734),F=r(67254),W=r(90035),N=r(26600),I=r(35316),P=r(68903),T=r(38624),D=r(81637),M=r(29347),O=r(98533),_=r(63471),z=r(63632),H=r(73216),R=r(26240),B=r(21268),L=r(94505),J=(r(37660),r(63777),r(22505)),G=r(70579);var V=r(66360),q=(r(45350),r(10105),r(47260)),U=r(85528),Z=r(53536),K=r(28499),X=r(69630);const Q=["Asbestos & HAZMAT","Occupational Hygiene","Client Supplied"],Y=["Asbestos Materials Assessment","Asbestos & Lead Paint Assessment","Lead Paint/Dust Assessment","Air Monitoring and Clearance","Clearance Certificate","Commercial Asbestos Management Plan","Hazardous Materials Management Plan","Residential Asbestos Survey","Silica Air Monitoring","Mould/Moisture Assessment","Other"],$={name:"",client:"",department:Q[0],categories:[],address:"",d_Date:"",workOrder:"",users:[],status:z.az[0],notes:"",projectContact:{name:"",number:"",email:""}},ee=e=>{if(!e)return"";let t="";if(e.firstName&&e.lastName)t="".concat(e.firstName," ").concat(e.lastName);else{if(!e.name)return"";t=e.name}return t.split(" ").map((e=>e[0])).join("").toUpperCase()},te=e=>{let t;t=e.name?e.name:e.firstName&&e.lastName?"".concat(e.firstName," ").concat(e.lastName):e._id?e._id:Math.random().toString();const r=t.split("").reduce(((e,t)=>t.charCodeAt(0)+((e<<5)-e)),0);return["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFD93D","#FF8B94","#6C5CE7","#00B894","#FDCB6E","#E17055","#0984E3","#6C5CE7","#00B894","#FDCB6E","#E17055","#00CEC9","#FF7675","#74B9FF","#A29BFE","#55EFC4"][Math.abs(r)%20]},re=e=>{switch(e){case"Assigned":case"Quote sent":return"#1976d2";case"In progress":return"#ed6c02";case"Samples submitted":return"#9c27b0";case"Lab Analysis Complete":return"#2e7d32";case"Report sent for review":case"Cancelled":return"#d32f2f";case"Ready for invoicing":return"#7b1fa2";case"Invoice sent":return"#388e3c";case"Job complete":return"#424242";case"On hold":return"#f57c00";default:return"#757575"}},ae=()=>{const e=(0,R.A)(),t=(0,H.Zp)(),{renderStatusCell:r,renderStatusSelect:ae,renderEditStatusCell:le}=((0,H.zy)(),(()=>{const[e,t]=(0,l.useState)(z.az[0]),r=(0,l.useCallback)((e=>{t(e)}),[]);return{JOB_STATUS:z.Pm,ACTIVE_STATUSES:z.az,INACTIVE_STATUSES:z.X_,selectedStatus:e,handleStatusChange:r,renderStatusSelect:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Status";return(0,G.jsxs)(i.A,{fullWidth:!0,required:!0,children:[(0,G.jsx)(c.A,{children:r}),(0,G.jsxs)(d.A,{name:"status",value:e,onChange:t,label:r,children:[(0,G.jsx)(m.A,{disabled:!0,children:(0,G.jsx)(h.A,{variant:"subtitle2",color:"text.secondary",children:"Active Jobs"})}),z.az.map((e=>(0,G.jsx)(m.A,{value:e,children:(0,G.jsx)(z.P5,{status:e})},e))),(0,G.jsx)(x.A,{}),(0,G.jsx)(m.A,{disabled:!0,children:(0,G.jsx)(h.A,{variant:"subtitle2",color:"text.secondary",children:"Inactive Jobs"})}),z.X_.map((e=>(0,G.jsx)(m.A,{value:e,children:(0,G.jsx)(z.P5,{status:e})},e)))]})]})},renderStatusCell:e=>(0,G.jsx)(z.P5,{status:e.value}),renderEditStatusCell:e=>(0,G.jsx)(n.A,{sx:{width:"100%"},children:(0,G.jsxs)(d.A,{value:e.value,onChange:t=>{console.log("Status change in cell:",t.target.value),e.api.setEditCellValue({id:e.id,field:e.field,value:t.target.value},!0)},sx:{width:"100%"},size:"small",children:[(0,G.jsx)(m.A,{disabled:!0,children:(0,G.jsx)(h.A,{variant:"subtitle2",color:"text.secondary",children:"Active Jobs"})}),z.az.map((e=>(0,G.jsx)(m.A,{value:e,children:(0,G.jsx)(z.P5,{status:e})},e))),(0,G.jsx)(x.A,{}),(0,G.jsx)(m.A,{disabled:!0,children:(0,G.jsx)(h.A,{variant:"subtitle2",color:"text.secondary",children:"Inactive Jobs"})}),z.X_.map((e=>(0,G.jsx)(m.A,{value:e,children:(0,G.jsx)(z.P5,{status:e})},e)))]})})}})()||{}),[ne,oe]=(0,l.useState)([]),[se,ie]=(0,l.useState)(!0),[ce,de]=(0,l.useState)(!1),[ue,me]=(0,l.useState)(null),[he,pe]=(0,l.useState)(!1),[Ae,xe]=(0,l.useState)(!1),[ge,je]=(0,l.useState)(null),[fe,ve]=(0,l.useState)($),[be,Ce]=(0,l.useState)([]),[ye,Se]=(0,l.useState)([]),[we,ke]=(0,l.useState)(!0),[Ee,Fe]=(0,l.useState)({page:1,limit:100,total:0,pages:0}),[We,Ne]=(0,l.useState)(""),[Ie,Pe]=(0,l.useState)("all"),[Te,De]=(0,l.useState)("all"),[Me,Oe]=(0,l.useState)([{field:"projectID",sort:"desc"}]),[_e,ze]=(0,l.useState)({name:"",email:"",phone:"",address:"",invoiceEmail:"",contact1Name:"",contact1Number:"",contact1Email:"",contact2Name:"",contact2Number:"",contact2Email:""}),[He,Re]=(0,l.useState)(!1),[Be,Le]=(0,l.useState)(null),[Je,Ge]=(0,l.useState)({projectID:!0,name:!0,client:!0,d_Date:!0,status:!0,department:!1,workOrder:!1,users:!0,createdAt:!1,updatedAt:!1}),[Ve,qe]=(0,l.useState)(!1),[Ue,Ze]=(0,l.useState)((()=>{const e=localStorage.getItem("projects-filters");if(e)try{const t=JSON.parse(e);if(t.departmentFilter&&"all"!==t.departmentFilter)return t.departmentFilter}catch(ue){console.error("Error parsing saved department filter:",ue)}return"All"})),[Ke,Xe]=(0,l.useState)({pageSize:50,page:0}),[Qe,Ye]=(0,l.useState)(null),$e=(0,l.useRef)(!0),et=((0,l.useRef)(!1),(0,l.useRef)(null)),tt=(0,l.useRef)(null);(0,l.useRef)(We).current=We;const rt=(0,l.useRef)(null),[at,lt]=(0,l.useState)(!1),[nt,ot]=(0,l.useState)(""),[st,it]=(0,l.useState)([]),[ct,dt]=(0,l.useState)(!1),[ut,mt]=(0,l.useState)(null),[ht,pt]=(0,l.useState)(null),[At,xt]=(0,l.useState)(null),[gt,jt]=(0,l.useState)("");(0,l.useEffect)((()=>{$e.current&&(et.current=U.A.startPageLoad("projects-page"),$e.current=!1)}),[]),(0,l.useEffect)((()=>{const e="AIzaSyATLgaqQ3hYzdwYlzgcTSNZQ0unRvXKlo0";console.log("Projects - Environment variables:",{REACT_APP_GOOGLE_MAPS_API_KEY:e?"API Key Found":"API Key Missing",NODE_ENV:"production"}),(0,X.A)(e).then((e=>{console.log("Projects - Google Maps loaded successfully"),xt(e);const t=new e.maps.places.AutocompleteService,r=new e.maps.places.PlacesService(document.createElement("div"));mt(t),pt(r)})).catch((e=>{console.error("Projects - Error loading Google Maps script:",e)}))}),[]);(0,l.useEffect)((()=>{!se&&ne.length>0&&(tt.current=performance.now(),U.A.startTimer("data-render"))}),[se,ne]);(0,l.useCallback)((()=>{tt.current&&(U.A.endTimer("data-render"),tt.current=null)}),[]);const[ft,vt]=(0,l.useState)((()=>{const e=localStorage.getItem("projects-filters"),t=new URLSearchParams(window.location.search),r={searchTerm:"",departmentFilter:"all",statusFilter:"all",sortModel:[{field:"projectID",sort:"desc"}]},l=t.get("status");t.get("active");if(e)try{const n=JSON.parse(e);return(0,a.A)((0,a.A)((0,a.A)({},r),n),{},{searchTerm:t.get("search")||n.searchTerm||"",departmentFilter:t.get("department")||n.departmentFilter||"all",statusFilter:l||t.get("status")||n.statusFilter||"all"})}catch(ue){return console.error("Error parsing saved filters:",ue),(0,a.A)((0,a.A)({},r),{},{statusFilter:l||r.statusFilter})}return(0,a.A)((0,a.A)({},r),{},{statusFilter:l||r.statusFilter})})),bt=(0,l.useRef)(ft);bt.current=ft;const Ct=(0,l.useCallback)((e=>{localStorage.setItem("projects-filters",JSON.stringify(e));const t=new URLSearchParams(window.location.search);e.searchTerm?t.set("search",e.searchTerm):t.delete("search"),"all"!==e.departmentFilter?t.set("department",e.departmentFilter):t.delete("department"),"all"!==e.statusFilter?t.set("status",e.statusFilter):t.delete("status"),window.history.replaceState({},"","".concat(window.location.pathname).concat(t.toString()?"?"+t.toString():""))}),[]),yt=(0,l.useCallback)(((e,t)=>{console.log("\ud83d\udd0d updateFilter called with:",e,t),vt((r=>{const l=(0,a.A)((0,a.A)({},r),{},{[e]:t});return console.log("\ud83d\udd0d New filters state:",l),Ct(l),l}))}),[Ct]),St=(0,l.useCallback)((async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bt.current.searchTerm,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;console.log("\ud83d\udd0d fetchProjectsWithPagination called with:"),console.log("  - searchValue:",t),console.log("  - isSearch:",r),console.log("  - currentFilters:",a),console.log("  - current filters state:",bt.current);const l=a||bt.current;console.log("\ud83d\udd0d filtersToUse:",l);try{var n,o,s,i,c;r?de(!0):ie(!0);const a={page:e.page+1,limit:e.pageSize,sortBy:(null===(n=l.sortModel[0])||void 0===n?void 0:n.field)||"createdAt",sortOrder:(null===(o=l.sortModel[0])||void 0===o?void 0:o.sort)||"desc"};t&&(a.search=t,console.log("\ud83d\udd0d Added search param:",t)),"all"!==l.departmentFilter&&(a.department=l.departmentFilter),"all"!==l.statusFilter&&(a.status=l.statusFilter),console.log("\ud83d\udd0d API call params:",a);const d=await L.projectService.getAll(a);console.log("\ud83d\udd0d API response:",d);const u=Array.isArray(d.data)?d.data:(null===(s=d.data)||void 0===s?void 0:s.data)||[];console.log("\ud83d\udd0d Processed projectsData length:",u.length),oe(u),Fe({total:(null===(i=d.data.pagination)||void 0===i?void 0:i.total)||0,pages:(null===(c=d.data.pagination)||void 0===c?void 0:c.pages)||0,page:e.page,limit:e.pageSize})}catch(d){console.error("Error fetching projects:",d),me(d.message),oe([])}finally{ie(!1),de(!1)}}),[]),wt=(0,l.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return St(Ke,bt.current.searchTerm,e,bt.current)}),[St,Ke]),kt=(0,l.useCallback)((0,Z.debounce)((e=>{console.log("\ud83d\udd0d debouncedSearch triggered with value:",e),console.log("\ud83d\udd0d Current paginationModel:",Ke),Xe((e=>(0,a.A)((0,a.A)({},e),{},{page:0}))),St({page:0,pageSize:Ke.pageSize},e,!0,null)}),150),[St,Ke.pageSize]),Et=(0,l.useCallback)(((e,t)=>{switch(e){case"department":yt("departmentFilter",t);break;case"status":yt("statusFilter",t)}Xe((e=>(0,a.A)((0,a.A)({},e),{},{page:0}))),(async()=>{try{var r,l,n;U.A.startTimer("fetch-projects"),de(!0);const o=(0,a.A)({},ft);switch(e){case"department":o.departmentFilter=t;break;case"status":o.statusFilter=t}const s={page:1,limit:Ke.pageSize,sortBy:(null===(r=o.sortModel[0])||void 0===r?void 0:r.field)||"createdAt",sortOrder:(null===(l=o.sortModel[0])||void 0===l?void 0:l.sort)||"desc"};o.searchTerm&&(s.search=o.searchTerm),"all"!==o.departmentFilter&&(s.department=o.departmentFilter),"all"!==o.statusFilter&&(s.status=o.statusFilter);const i=await L.projectService.getAll(s),c=Array.isArray(i.data)?i.data:(null===(n=i.data)||void 0===n?void 0:n.data)||[];oe(c),Fe((e=>{var t,r;return(0,a.A)((0,a.A)({},e),{},{total:(null===(t=i.data.pagination)||void 0===t?void 0:t.total)||0,pages:(null===(r=i.data.pagination)||void 0===r?void 0:r.pages)||0})}))}catch(o){console.error("Error fetching projects:",o),me(o.message),oe([])}finally{de(!1),U.A.endTimer("fetch-projects")}})()}),[yt,ft,Ke,St]),Ft=((0,l.useCallback)((()=>{const e={searchTerm:"",departmentFilter:"all",statusFilter:"all",sortModel:[{field:"projectID",sort:"desc"}]};vt(e),Ze("All"),Xe((e=>(0,a.A)((0,a.A)({},e),{},{page:0}))),localStorage.removeItem("projects-filters"),localStorage.removeItem("projects-column-visibility"),window.history.replaceState({},"",window.location.pathname);Ge({projectID:!0,name:!0,client:!0,d_Date:!0,status:!0,department:!0,users:!0,createdAt:!1,updatedAt:!1}),St({page:0,pageSize:Ke.pageSize},"",!1,e)}),[St,Ke.pageSize]),(0,l.useCallback)((e=>{const t=e.target.value;console.log("\ud83d\udd0d handleSearchChange called with value:",t),yt("searchTerm",t),console.log("\ud83d\udd0d After updateFilter, calling debouncedSearch with:",t),kt(t)}),[kt,yt]));(0,l.useEffect)((()=>{}),[Ke]),(0,l.useEffect)((()=>{const e=()=>{const e=localStorage.getItem("projects-filters");if(e)try{const t=JSON.parse(e);t.searchTerm&&(t.searchTerm="",localStorage.setItem("projects-filters",JSON.stringify(t)))}catch(ue){console.error("Error clearing search term:",ue)}};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e);const t=localStorage.getItem("projects-filters");if(t)try{const e=JSON.parse(t);e.searchTerm&&(e.searchTerm="",localStorage.setItem("projects-filters",JSON.stringify(e)))}catch(ue){console.error("Error clearing search term on unmount:",ue)}}}),[]),(0,l.useEffect)((()=>{!ce&&at&&rt.current&&setTimeout((()=>{var e;null===(e=rt.current)||void 0===e||e.focus()}),50)}),[ce,at]);(0,l.useCallback)((e=>{Fe((t=>(0,a.A)((0,a.A)({},t),{},{page:e})))}),[]),(0,l.useCallback)((e=>{Fe((t=>(0,a.A)((0,a.A)({},t),{},{limit:e,page:1})))}),[]);const Wt=(0,l.useCallback)((e=>{yt("sortModel",e)}),[yt]);(0,l.useEffect)((()=>{(async()=>{try{const e=await L.clientService.getAll();console.log("Clients response:",e),console.log("Clients data:",e.data);const t=e.data.clients||e.data;console.log("Final clients array:",t),console.log("Number of clients fetched:",t.length),Ce(t)}catch(e){console.error("Error fetching clients:",e)}})()}),[]),(0,l.useEffect)((()=>{(async()=>{try{if(!localStorage.getItem("token"))return console.error("No authentication token found"),void ke(!1);const e=await L.Dv.getAll(),t=e.data.filter((e=>!0===e.isActive)).map((e=>(0,a.A)((0,a.A)({},e),{},{name:"".concat(e.firstName," ").concat(e.lastName)})));Se(t),ke(!1)}catch(e){console.error("Error fetching users:",e),ke(!1)}})()}),[]),(0,l.useEffect)((()=>{wt(!1)}),[]);const Nt=e=>{const{name:t,value:r}=e.target;ve((e=>{if(t.includes("projectContact")){const[l,n]=t.split(".");return(0,a.A)((0,a.A)({},e),{},{projectContact:(0,a.A)((0,a.A)({},e.projectContact),{},{[n]:r})})}return(0,a.A)((0,a.A)({},e),{},{[t]:r})}))},It=e=>{let{users:t}=e;return t&&0!==t.length?(0,G.jsx)(n.A,{sx:{display:"flex",gap:.5},children:t.map(((e,t)=>(0,G.jsx)(o.A,{title:"".concat(e.firstName," ").concat(e.lastName),children:(0,G.jsx)(s.A,{sx:{width:24,height:24,fontSize:"0.75rem",bgcolor:te(e)},children:ee(e)})},e._id||t)))}):(0,G.jsx)("span",{children:"-"})},Pt=(0,l.useCallback)((e=>{Ge(e)}),[]),Tt=e=>{Ze(e);const t="All"===e?"all":e;yt("departmentFilter",t),Xe((e=>(0,a.A)((0,a.A)({},e),{},{page:0})));const r=(0,a.A)((0,a.A)({},ft),{},{departmentFilter:t});(async()=>{try{var e,l,n;U.A.startTimer("fetch-projects"),de(!0);const o={page:1,limit:Ke.pageSize,sortBy:(null===(e=r.sortModel[0])||void 0===e?void 0:e.field)||"createdAt",sortOrder:(null===(l=r.sortModel[0])||void 0===l?void 0:l.sort)||"desc"};r.searchTerm&&(o.search=r.searchTerm),"all"!==t&&(o.department=t),"all"!==r.statusFilter&&(o.status=r.statusFilter);const s=await L.projectService.getAll(o),i=Array.isArray(s.data)?s.data:(null===(n=s.data)||void 0===n?void 0:n.data)||[];oe(i),Fe((e=>{var t,r,l,n;return(0,a.A)((0,a.A)({},e),{},{total:(null===(t=s.data)||void 0===t||null===(r=t.pagination)||void 0===r?void 0:r.total)||0,pages:(null===(l=s.data)||void 0===l||null===(n=l.pagination)||void 0===n?void 0:n.pages)||0})}))}catch(o){console.error("Error fetching projects:",o),me(o.message),oe([])}finally{de(!1),U.A.endTimer("fetch-projects")}})()};(0,l.useCallback)((e=>{Xe(e),St(e,ft.searchTerm,!1)}),[St,ft.searchTerm]);(0,l.useEffect)((()=>{(async()=>{try{var e,t;const r=await L.Tc.getPreferences();null!==(e=r.data)&&void 0!==e&&null!==(t=e.columnVisibility)&&void 0!==t&&t.projects&&Ge(r.data.columnVisibility.projects)}catch(ue){console.error("Error loading user preferences:",ue);const t=localStorage.getItem("projects-column-visibility");if(t)try{const e=JSON.parse(t);Ge(e)}catch(r){console.error("Error parsing saved column visibility:",r)}}})()}),[]);const Dt=(0,l.useMemo)((()=>[{field:"projectID",headerName:"Project ID",flex:0,width:105,minWidth:105,maxWidth:105,renderCell:e=>(0,G.jsx)(n.A,{onClick:()=>t("/projects/".concat(e.row._id)),sx:{cursor:"pointer"},children:e.value})},{field:"name",headerName:"Project Name",flex:2,minWidth:190,maxWidth:400,renderCell:r=>{let{row:a}=r;return(0,G.jsx)(n.A,{onClick:()=>t("/projects/".concat(a._id)),sx:{cursor:"pointer","&:hover":{color:e.palette.primary.main},whiteSpace:"normal",wordWrap:"break-word",lineHeight:1.2,height:"100%",display:"flex",alignItems:"center"},children:a.name})}},{field:"workOrder",headerName:"Work Order/Job Reference",flex:1,minWidth:150,hide:!0},{field:"client",headerName:"Client",flex:1,minWidth:140,maxWidth:220,renderCell:e=>{var t;let{row:r}=e;return(0,G.jsx)(h.A,{variant:"body2",sx:{whiteSpace:"normal",wordWrap:"break-word",lineHeight:1.2,maxHeight:"2.4em",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",width:"100%"},children:(null===(t=r.client)||void 0===t?void 0:t.name)||r.client||""})}},{field:"d_Date",headerName:"Due Date",flex:1,minWidth:100,maxWidth:120,renderCell:e=>{let{row:t}=e;const r=(e=>{if(!e)return null;const t=new Date;t.setHours(0,0,0,0);const r=new Date(e);r.setHours(0,0,0,0);const a=r.getTime()-t.getTime();return Math.ceil(a/864e5)})(t.d_Date);return t.d_Date?0===r?(0,G.jsx)(h.A,{variant:"body2",sx:{color:"#f57c00",fontWeight:"bold",whiteSpace:"normal",wordWrap:"break-word",lineHeight:1.2,maxHeight:"2.4em",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",width:"100%"},children:"Due today"}):r<0?(0,G.jsxs)(h.A,{variant:"body2",sx:{color:"#d32f2f",fontWeight:"bold",whiteSpace:"normal",wordWrap:"break-word",lineHeight:1.2,maxHeight:"2.4em",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",width:"100%"},children:[Math.abs(r)," days overdue"]}):(0,G.jsxs)(h.A,{variant:"body2",sx:{color:"#2e7d32",whiteSpace:"normal",wordWrap:"break-word",lineHeight:1.2,maxHeight:"2.4em",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",width:"100%"},children:[r," days left"]}):(0,G.jsx)(h.A,{variant:"body2",color:"text.secondary",sx:{whiteSpace:"normal",wordWrap:"break-word",lineHeight:1.2,maxHeight:"2.4em",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",width:"100%"},children:"No due date"})}},{field:"department",headerName:"Department",flex:1},{field:"status",headerName:"Status",flex:1,minWidth:60,maxWidth:165,renderCell:e=>(0,G.jsx)(n.A,{sx:{backgroundColor:re(e.value),color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"0.75rem"},children:e.value})},{field:"users",headerName:"Users",flex:1,minWidth:60,maxWidth:120,renderCell:e=>(0,G.jsx)(It,{users:e.row.users})},{field:"actions",headerName:"Actions",flex:1,minWidth:120,maxWidth:160,renderCell:e=>(0,G.jsxs)(n.A,{children:[(0,G.jsx)(p.A,{variant:"contained",size:"small",startIcon:(0,G.jsx)(q.A,{}),onClick:()=>t("/projects/".concat(e.row._id)),sx:{mr:1},children:"Details"}),(0,G.jsx)(A.A,{onClick:()=>{return t=e.row,je(t),void xe(!0);var t},size:"small",color:"error",children:(0,G.jsx)(_.A,{})})]})}]),[t]),Mt=ae||function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Status";return(0,G.jsxs)(i.A,{fullWidth:!0,required:!0,children:[(0,G.jsx)(c.A,{children:r}),(0,G.jsxs)(d.A,{name:"status",value:e,onChange:t,label:r,children:[(0,G.jsx)(m.A,{disabled:!0,children:(0,G.jsx)(h.A,{variant:"subtitle2",color:"text.secondary",children:"Active Jobs"})}),z.az.map((e=>(0,G.jsx)(m.A,{value:e,children:e},e))),(0,G.jsx)(x.A,{}),(0,G.jsx)(m.A,{disabled:!0,children:(0,G.jsx)(h.A,{variant:"subtitle2",color:"text.secondary",children:"Inactive Jobs"})}),z.X_.map((e=>(0,G.jsx)(m.A,{value:e,children:e},e)))]})]})};return se?(0,G.jsx)(h.A,{children:"Loading projects..."}):ue?(0,G.jsx)(h.A,{color:"error",children:ue}):Dt&&0!==Dt.length?(0,G.jsxs)(n.A,{m:"5px 0px 20px 20px",children:[ce&&(0,G.jsx)(n.A,{sx:{width:"100%",mb:2},children:(0,G.jsx)(g.A,{sx:{height:3,borderRadius:1.5,backgroundColor:"rgba(25, 118, 210, 0.1)","& .MuiLinearProgress-bar":{backgroundColor:"#1976d2"}}})}),(0,G.jsx)(n.A,{sx:{mb:2},children:(0,G.jsxs)(p.A,{variant:"contained",color:"secondary",onClick:()=>pe(!0),fullWidth:!0,sx:{backgroundColor:e.palette.primary.main,"&:hover":{backgroundColor:e.palette.primary.dark},height:60,fontSize:"1.2rem",fontWeight:"bold",border:"2px solid rgb(83, 84, 85)",py:2},children:[(0,G.jsx)(J.A,{sx:{mr:1}}),"ADD PROJECT"]})}),(0,G.jsx)(n.A,{mt:"5px",mb:"20px",sx:{backgroundColor:"background.paper",borderRadius:"4px",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)",p:2},children:(0,G.jsx)(j.A,{direction:"row",spacing:2,alignItems:"center",justifyContent:"space-between",children:(0,G.jsxs)(j.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,G.jsx)(f.A,{label:"Search Projects",variant:"outlined",size:"small",placeholder:"Enter search term",value:ft.searchTerm,onChange:Ft,InputProps:{startAdornment:(0,G.jsx)(v.A,{position:"start",children:(0,G.jsx)(V.A,{})})},sx:{minWidth:300},ref:rt,onFocus:()=>{lt(!0)},onBlur:()=>{lt(!1)}}),(0,G.jsxs)(i.A,{size:"small",sx:{minWidth:200},children:[(0,G.jsx)(c.A,{children:"Status"}),(0,G.jsxs)(d.A,{value:ft.statusFilter,label:"Status",onChange:e=>Et("status",e.target.value),children:[(0,G.jsx)(m.A,{value:"all",children:"All Statuses"}),(0,G.jsx)(m.A,{value:"all_active",children:"Active"}),(0,G.jsx)(m.A,{value:"all_inactive",children:"Inactive"}),(0,G.jsx)(x.A,{}),(0,G.jsx)(m.A,{disabled:!0,children:(0,G.jsx)(h.A,{variant:"subtitle2",color:"text.secondary",children:"Active Statuses"})}),z.az.map((e=>(0,G.jsx)(m.A,{value:e,children:e},e))),(0,G.jsx)(x.A,{}),(0,G.jsx)(m.A,{disabled:!0,children:(0,G.jsx)(h.A,{variant:"subtitle2",color:"text.secondary",children:"Inactive Statuses"})}),z.X_.map((e=>(0,G.jsx)(m.A,{value:e,children:e},e)))]})]}),(0,G.jsx)(p.A,{variant:"outlined",size:"small",startIcon:(0,G.jsx)(K.A,{}),onClick:e=>{Ye(e.currentTarget)},sx:{height:40,minWidth:140,color:e.palette.primary.main,borderColor:e.palette.primary.main,"&:hover":{backgroundColor:e.palette.primary.main,color:"white",borderColor:e.palette.primary.main}},children:"Columns"})]})})}),(0,G.jsx)(b.Ay,{open:Boolean(Qe),anchorEl:Qe,onClose:()=>{Ye(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{minWidth:200,maxHeight:400}},children:(0,G.jsxs)(n.A,{sx:{p:1},children:[(0,G.jsx)(h.A,{variant:"subtitle2",sx:{p:1,fontWeight:"bold"},children:"Show/Hide Columns"}),(0,G.jsx)(x.A,{sx:{mb:1}}),(0,G.jsx)(C.A,{dense:!0,children:Dt.map((e=>(0,G.jsx)(y.Ay,{disablePadding:!0,children:(0,G.jsxs)(S.A,{dense:!0,onClick:()=>(async e=>{const t=(0,a.A)((0,a.A)({},Je),{},{[e]:!Je[e]});Ge(t);try{await L.Tc.updatePreferences({columnVisibility:{projects:t}})}catch(ue){console.error("Error saving column visibility preferences:",ue),localStorage.setItem("projects-column-visibility",JSON.stringify(t))}})(e.field),children:[(0,G.jsx)(w.A,{sx:{minWidth:36},children:(0,G.jsx)(k.A,{edge:"start",checked:!1!==Je[e.field],tabIndex:-1,disableRipple:!0,size:"small"})}),(0,G.jsx)(E.A,{primary:e.headerName,primaryTypographyProps:{fontSize:"0.875rem"}})]})},e.field)))})]})}),(0,G.jsxs)(n.A,{display:"flex",justifyContent:"flex-start",alignItems:"center",gap:1,mb:2,children:[(0,G.jsx)(p.A,{variant:"All"===Ue?"contained":"outlined",onClick:()=>Tt("All"),sx:{backgroundColor:"All"===Ue?"#1976d2":"transparent",color:"All"===Ue?"#fff":"#1976d2",borderColor:"#1976d2","&:hover":{backgroundColor:"#1976d2",color:"#fff"}},children:"All Departments"}),Q.map((e=>(0,G.jsx)(p.A,{variant:Ue===e?"contained":"outlined",onClick:()=>Tt(e),sx:{backgroundColor:Ue===e?"Asbestos & HAZMAT"===e?"#2e7d32":"Occupational Hygiene"===e?"#ed6c02":"#9c27b0":"transparent",color:Ue===e?"#fff":"Asbestos & HAZMAT"===e?"#2e7d32":"Occupational Hygiene"===e?"#ed6c02":"#9c27b0",borderColor:"Asbestos & HAZMAT"===e?"#2e7d32":"Occupational Hygiene"===e?"#ed6c02":"#9c27b0","&:hover":{backgroundColor:"Asbestos & HAZMAT"===e?"#2e7d32":"Occupational Hygiene"===e?"#ed6c02":"#9c27b0",color:"#fff"}},children:e},e)))]}),ue&&(0,G.jsx)(F.A,{severity:"error",sx:{mb:2},children:ue}),(0,G.jsx)(n.A,{m:"40px 0 0 0",sx:{"& .MuiDataGrid-root":{border:"none"},"& .MuiDataGrid-cell":{borderBottom:"1px solid ".concat(e.palette.divider),color:"#000000"},"& .MuiDataGrid-columnHeaders":{backgroundColor:e.palette.primary.main,borderBottom:"none",color:"#FFFFFF"},"& .MuiDataGrid-columnHeader":{color:"#FFFFFF",fontWeight:600},"& .MuiDataGrid-virtualScroller":{backgroundColor:"#FFFFFF"},"& .MuiDataGrid-footerContainer":{borderTop:"none",backgroundColor:e.palette.primary.main,color:"#FFFFFF"},"& .MuiCheckbox-root":{color:"".concat(e.palette.secondary.main," !important")}},children:(0,G.jsx)(B.zh,{rows:ne,columns:Dt,getRowId:e=>e._id||e.id,loading:se&&!ce,error:ue,checkboxSelection:!0,disableRowSelectionOnClick:!0,columnVisibilityModel:Je,onColumnVisibilityModelChange:Pt,paginationMode:"server",rowCount:Ee.total,paginationModel:Ke,onPaginationModelChange:e=>{Xe(e),St(e)},pageSizeOptions:[25,50,100],onSortModelChange:Wt,sortModel:ft.sortModel,autoHeight:!0,disableColumnMenu:!1,disableSelectionOnClick:!0,disableColumnFilter:!1,disableMultipleColumnsFiltering:!0,disableColumnSelector:!1,disableDensitySelector:!1,disableColumnReorder:!1,disableMultipleColumnsSorting:!0,initialState:{pagination:{paginationModel:{pageSize:50,page:0}}},sx:{"& .MuiDataGrid-row:nth-of-type(even)":{backgroundColor:"#f8f9fa"},"& .MuiDataGrid-row:nth-of-type(odd)":{backgroundColor:"#ffffff"},"& .MuiDataGrid-row:hover":{backgroundColor:"#e3f2fd"}}})}),(0,G.jsxs)(W.A,{open:he,onClose:()=>{pe(!1),ve($)},maxWidth:"md",fullWidth:!0,children:[(0,G.jsx)(N.A,{children:ge?"Edit Project":"Add New Project"}),(0,G.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{console.log("=== SUBMITTING PROJECT FORM ==="),console.log("Form data being sent:",fe),console.log("Form data type:",typeof fe),console.log("Client value:",fe.client),console.log("Department value:",fe.department),console.log("Users value:",fe.users),console.log("===============================");const e=await L.projectService.create(fe);oe([...ne,e.data]),pe(!1),ve($)}catch(ue){var t;console.error("Error creating project:",ue),console.error("Error response:",null===(t=ue.response)||void 0===t?void 0:t.data),me("Failed to create project")}},children:[(0,G.jsx)(I.A,{children:(0,G.jsx)(n.A,{sx:{mt:2},children:(0,G.jsxs)(P.Ay,{container:!0,spacing:2,children:[(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsx)(f.A,{label:"Project ID",value:"Will be auto-generated",disabled:!0,fullWidth:!0,sx:{"& .MuiInputBase-input.Mui-disabled":{WebkitTextFillColor:"#666",fontStyle:"italic"}}})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsx)(f.A,{label:"Project Name",name:"name",value:fe.name,onChange:Nt,required:!0,fullWidth:!0})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsxs)(n.A,{children:[(0,G.jsx)(T.A,{options:be,getOptionLabel:e=>e.name||"",value:be.find((e=>e._id===fe.client))||null,onChange:(e,t)=>{ve((e=>(0,a.A)((0,a.A)({},e),{},{client:t?t._id:""})))},inputValue:gt,onInputChange:(e,t)=>jt(t),filterOptions:(e,t)=>{let{inputValue:r}=t;if(r.length<3)return[];const a=r.toLowerCase();return e.filter((e=>e.name.toLowerCase().includes(a)))},includeInputInList:!0,filterSelectedOptions:!0,renderInput:e=>(0,G.jsx)(f.A,(0,a.A)((0,a.A)({},e),{},{label:"Client",required:!0,fullWidth:!0,helperText:gt.length<3?"Type at least 3 characters to search clients":""})),isOptionEqualToValue:(e,t)=>e._id===t._id}),(0,G.jsx)(p.A,{startIcon:(0,G.jsx)(J.A,{}),onClick:()=>Re(!0),sx:{mt:1},children:"Add New Client"})]})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsxs)(i.A,{fullWidth:!0,required:!0,children:[(0,G.jsx)(c.A,{children:"Department"}),(0,G.jsx)(d.A,{name:"department",value:fe.department,onChange:Nt,label:"Department",children:Q.map((e=>(0,G.jsx)(m.A,{value:e,children:e},e)))})]})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsx)(i.A,{fullWidth:!0,children:(0,G.jsx)(T.A,{multiple:!0,options:Y,value:fe.categories,onChange:(e,t)=>{ve((e=>(0,a.A)((0,a.A)({},e),{},{categories:t})))},renderInput:e=>(0,G.jsx)(f.A,(0,a.A)((0,a.A)({},e),{},{label:"Categories",placeholder:"Select categories"})),renderTags:(e,t)=>e.map(((e,r)=>(0,G.jsx)(u.A,(0,a.A)({label:e},t({index:r})))))})})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsx)(i.A,{fullWidth:!0,required:!0,children:Mt(fe.status,Nt)})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsx)(T.A,{freeSolo:!0,options:st,getOptionLabel:e=>"string"===typeof e?e:e.description,inputValue:nt,onInputChange:(e,t)=>(async e=>{if(ot(e),e&&!(e.length<3)&&ut&&At){dt(!0);try{ut.getPlacePredictions({input:e,componentRestrictions:{country:"au"},types:["address"]},((e,t)=>{console.log("Projects - Address predictions:",e,"Status:",t),t===At.maps.places.PlacesServiceStatus.OK&&e?it(e):(console.log("Projects - No predictions found or error:",t),it([])),dt(!1)}))}catch(ue){console.error("Projects - Error fetching address predictions:",ue),it([]),dt(!1)}}else it([])})(t),onChange:(e,t)=>{t&&t.place_id?(async e=>{if(e&&ht&&At)try{ht.getDetails({placeId:e,fields:["formatted_address","geometry","address_components"]},((e,t)=>{console.log("Projects - Selected place:",e,"Status:",t),t===At.maps.places.PlacesServiceStatus.OK&&e?(ve((t=>(0,a.A)((0,a.A)({},t),{},{address:e.formatted_address}))),ot(e.formatted_address)):console.error("Projects - Error getting place details:",t)}))}catch(ue){console.error("Projects - Error getting place details:",ue)}})(t.place_id):"string"===typeof t&&(ve((e=>(0,a.A)((0,a.A)({},e),{},{address:t}))),ot(t))},loading:ct,renderInput:e=>(0,G.jsx)(f.A,(0,a.A)((0,a.A)({},e),{},{fullWidth:!0,label:"Address (Optional)",name:"address",InputProps:(0,a.A)((0,a.A)({},e.InputProps),{},{endAdornment:(0,G.jsxs)(G.Fragment,{children:[ct?(0,G.jsx)(D.A,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})})),renderOption:(e,t)=>(0,G.jsx)("li",(0,a.A)((0,a.A)({},e),{},{children:(0,G.jsx)(h.A,{children:t.description})}))})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsx)(f.A,{label:"Due Date",name:"d_Date",type:"date",value:fe.d_Date||"",onChange:Nt,fullWidth:!0,InputLabelProps:{shrink:!0}})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsx)(f.A,{label:"Work Order/Job Reference",name:"workOrder",value:fe.workOrder,onChange:Nt,fullWidth:!0,variant:"outlined",size:"small",placeholder:"Enter work order or job reference number"})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsx)(f.A,{label:"Notes",name:"notes",value:fe.notes,onChange:Nt,fullWidth:!0,multiline:!0,rows:4,placeholder:"Enter any additional notes about the project"})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsx)(h.A,{variant:"subtitle1",sx:{mt:2,mb:1,fontWeight:"bold"},children:"Project Team"})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsx)(T.A,{multiple:!0,options:ye,getOptionLabel:e=>"".concat(e.firstName," ").concat(e.lastName),value:fe.users,onChange:(e,t)=>{ve((e=>(0,a.A)((0,a.A)({},e),{},{users:t})))},isOptionEqualToValue:(e,t)=>e._id===t._id,renderInput:e=>(0,G.jsx)(f.A,(0,a.A)((0,a.A)({},e),{},{label:"Users (Optional)",fullWidth:!0}))})})]})})}),(0,G.jsxs)(M.A,{children:[(0,G.jsx)(p.A,{onClick:()=>pe(!1),children:"Cancel"}),(0,G.jsx)(p.A,{type:"submit",children:"Save"})]})]})]}),(0,G.jsxs)(W.A,{open:Ae,onClose:()=>xe(!1),maxWidth:"sm",fullWidth:!0,children:[(0,G.jsx)(N.A,{children:"Confirm Delete"}),(0,G.jsx)(I.A,{children:(0,G.jsxs)(O.A,{children:['Are you sure you want to delete the project "',null===ge||void 0===ge?void 0:ge.name,'"? This action cannot be undone.']})}),(0,G.jsxs)(M.A,{children:[(0,G.jsx)(p.A,{onClick:()=>xe(!1),children:"Cancel"}),(0,G.jsx)(p.A,{onClick:async()=>{try{console.log("=== DELETING PROJECT ==="),console.log("Selected project:",ge),console.log("Project ID to delete:",(null===ge||void 0===ge?void 0:ge._id)||(null===ge||void 0===ge?void 0:ge.id)),console.log("=========================");const e=(null===ge||void 0===ge?void 0:ge._id)||(null===ge||void 0===ge?void 0:ge.id);if(!e)return console.error("No project ID found for deletion"),void me("Cannot delete project: No project ID found");await L.projectService.delete(e),oe(ne.filter((t=>(t._id||t.id)!==e))),xe(!1),je(null)}catch(ue){var e;console.error("Error deleting project:",ue),console.error("Error response:",null===(e=ue.response)||void 0===e?void 0:e.data),me("Failed to delete project")}},color:"error",variant:"contained",children:"Delete"})]})]}),(0,G.jsxs)(W.A,{open:He,onClose:()=>Re(!1),maxWidth:"md",fullWidth:!0,children:[(0,G.jsx)(N.A,{children:"Add New Client"}),(0,G.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=await L.clientService.create(_e);Ce([...be,e.data]),ve((0,a.A)((0,a.A)({},fe),{},{client:e.data._id})),Re(!1),ze({name:"",email:"",phone:"",address:"",invoiceEmail:"",contact1Name:"",contact1Number:"",contact1Email:"",contact2Name:"",contact2Number:"",contact2Email:""})}catch(t){t.response&&alert("Error creating client: ".concat(t.response.data.message||"Unknown error"))}},children:[(0,G.jsx)(I.A,{children:(0,G.jsx)(n.A,{sx:{mt:2},children:(0,G.jsxs)(P.Ay,{container:!0,spacing:2,children:[(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsx)(f.A,{label:"Client Name",name:"name",value:_e.name,onChange:e=>ze((0,a.A)((0,a.A)({},_e),{},{name:e.target.value})),required:!0,fullWidth:!0})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsx)(f.A,{label:"Email",name:"email",value:_e.email,onChange:e=>ze((0,a.A)((0,a.A)({},_e),{},{email:e.target.value})),required:!0,fullWidth:!0})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsx)(f.A,{label:"Phone",name:"phone",value:_e.phone,onChange:e=>ze((0,a.A)((0,a.A)({},_e),{},{phone:e.target.value})),required:!0,fullWidth:!0})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsx)(f.A,{label:"Address",name:"address",value:_e.address,onChange:e=>ze((0,a.A)((0,a.A)({},_e),{},{address:e.target.value})),fullWidth:!0})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsx)(f.A,{label:"Invoice Email",name:"invoiceEmail",value:_e.invoiceEmail,onChange:e=>ze((0,a.A)((0,a.A)({},_e),{},{invoiceEmail:e.target.value})),fullWidth:!0})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsx)(h.A,{variant:"subtitle1",sx:{mt:2,mb:1},children:"Primary Contact"})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,md:4,children:(0,G.jsx)(f.A,{label:"Name",name:"contact1Name",value:_e.contact1Name,onChange:e=>ze((0,a.A)((0,a.A)({},_e),{},{contact1Name:e.target.value})),fullWidth:!0})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,md:4,children:(0,G.jsx)(f.A,{label:"Phone",name:"contact1Number",value:_e.contact1Number,onChange:e=>ze((0,a.A)((0,a.A)({},_e),{},{contact1Number:e.target.value})),fullWidth:!0})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,md:4,children:(0,G.jsx)(f.A,{label:"Email",name:"contact1Email",value:_e.contact1Email,onChange:e=>ze((0,a.A)((0,a.A)({},_e),{},{contact1Email:e.target.value})),fullWidth:!0})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,children:(0,G.jsx)(h.A,{variant:"subtitle1",sx:{mt:2,mb:1},children:"Secondary Contact (Optional)"})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,md:4,children:(0,G.jsx)(f.A,{label:"Name",name:"contact2Name",value:_e.contact2Name,onChange:e=>ze((0,a.A)((0,a.A)({},_e),{},{contact2Name:e.target.value})),fullWidth:!0})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,md:4,children:(0,G.jsx)(f.A,{label:"Phone",name:"contact2Number",value:_e.contact2Number,onChange:e=>ze((0,a.A)((0,a.A)({},_e),{},{contact2Number:e.target.value})),fullWidth:!0})}),(0,G.jsx)(P.Ay,{item:!0,xs:12,md:4,children:(0,G.jsx)(f.A,{label:"Email",name:"contact2Email",value:_e.contact2Email,onChange:e=>ze((0,a.A)((0,a.A)({},_e),{},{contact2Email:e.target.value})),fullWidth:!0})})]})})}),(0,G.jsxs)(M.A,{children:[(0,G.jsx)(p.A,{onClick:()=>Re(!1),children:"Cancel"}),(0,G.jsx)(p.A,{type:"submit",variant:"contained",children:"Add Client"})]})]})]})]}):(0,G.jsx)(h.A,{children:"Loading columns..."})}}}]);
//# sourceMappingURL=212.ee7cd674.chunk.js.map