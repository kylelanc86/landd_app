"use strict";(self.webpackChunkair_monitoring_frontend=self.webpackChunkair_monitoring_frontend||[]).push([[956],{3632:(e,a,s)=>{s.d(a,{A:()=>n});var t=s(59662),c=s(70579);const n=(0,t.A)((0,c.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")},45360:(e,a,s)=>{s.d(a,{A:()=>r});var t=s(89379),c=s(82431);const n="/asbestos-clearances",r={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await c.A.get(n,{params:e})).data},getById:async e=>(await c.A.get("".concat(n,"/").concat(e))).data,create:async e=>(await c.A.post(n,e)).data,update:async(e,a)=>(await c.A.put("".concat(n,"/").concat(e),a)).data,delete:async e=>(await c.A.delete("".concat(n,"/").concat(e))).data,updateStatus:async(e,a)=>(await c.A.patch("".concat(n,"/").concat(e,"/status"),{status:a})).data,getStats:async()=>(await c.A.get("".concat(n,"/stats/overview"))).data,search:async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=(0,t.A)({search:e},a);return(await c.A.get(n,{params:s})).data},getByStatus:async e=>(await c.A.get(n,{params:{status:e}})).data,getByRemovalist:async e=>(await c.A.get(n,{params:{asbestosRemovalist:e}})).data}},60956:(e,a,s)=>{s.r(a),s.d(a,{default:()=>G});var t=s(89379),c=s(65043),n=s(96446),r=s(81637),l=s(67254),i=s(85865),o=s(11906),d=s(12110),A=s(26494),h=s(79650),u=s(63336),j=s(71806),x=s(84882),p=s(28076),m=s(10039),y=s(73460),g=s(43845),v=s(17392),f=s(90035),b=s(26600),C=s(35316),w=s(68903),D=s(53193),I=s(79190),S=s(72221),P=s(32143),k=s(15795),L=s(29347),R=s(73158),_=s(70141),H=s(3632),z=s(83560),T=s(59662),F=s(70579);const W=(0,T.A)((0,F.jsx)("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5zm4-3H19v1h1.5V11H19v2h-1.5V7h3zM9 9.5h1v-1H9zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm10 5.5h1v-3h-1z"}),"PictureAsPdf");var E=s(51387),N=s(73216),V=s(63777),q=s(88027),B=s(45360),M=s(76961),U=s(43381);const G=()=>{const e=V.LU,a=(0,N.Zp)(),[s,T]=(0,c.useState)([]),[G,O]=(0,c.useState)([]),[Z,J]=(0,c.useState)(!0),[K,Q]=(0,c.useState)(null),[X,Y]=(0,c.useState)(!1),[$,ee]=(0,c.useState)(null),[ae,se]=(0,c.useState)(!1),[te,ce]=(0,c.useState)({open:!1,message:"",severity:"success"}),[ne,re]=(0,c.useState)({projectId:"",clearanceDate:"",clearanceType:"Non-friable",LAA:"",asbestosRemovalist:"",notes:""});(0,c.useEffect)((()=>{le()}),[]);const le=async()=>{try{J(!0);const[e,a]=await Promise.all([B.A.getAll(),M.A.getAll({limit:1e3,status:"Assigned,In progress,Samples submitted,Lab Analysis Complete,Report sent for review,Ready for invoicing,Invoice sent"})]);console.log("Clearances API response:",e),console.log("Projects API response:",a),T(e.clearances||e.data||e||[]),O(a.data||a)}catch(e){console.error("Error fetching data:",e),Q("Failed to load data")}finally{J(!1)}},ie=()=>{re({projectId:"",clearanceDate:"",clearanceType:"Non-friable",LAA:"",asbestosRemovalist:"",notes:""})},oe=e=>{switch(e){case"complete":return"success";case"in progress":return"warning";case"Site Work Complete":return"info";default:return"default"}},de=e=>{const a=G.find((a=>a._id===e));return a?a.name:"Unknown Project"};return Z?(0,F.jsx)(n.A,{display:"flex",justifyContent:"center",alignItems:"center",height:"400px",children:(0,F.jsx)(r.A,{})}):K?(0,F.jsx)(n.A,{m:"20px",children:(0,F.jsx)(l.A,{severity:"error",children:K})}):(0,F.jsx)(q.A,{requiredPermissions:["asbestos.view"],children:(0,F.jsxs)(n.A,{m:"20px",children:[(0,F.jsxs)(n.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,F.jsx)(i.A,{variant:"h2",color:e.grey[100],fontWeight:"bold",sx:{mb:"5px"},children:"Asbestos Clearance"}),(0,F.jsx)(o.A,{variant:"contained",color:"secondary",onClick:()=>{ee(null),ie(),Y(!0)},startIcon:(0,F.jsx)(_.A,{}),children:"Add Clearance"})]}),(0,F.jsx)(d.A,{sx:{mt:3},children:(0,F.jsx)(A.A,{children:(0,F.jsx)(h.A,{component:u.A,children:(0,F.jsxs)(j.A,{children:[(0,F.jsx)(x.A,{children:(0,F.jsxs)(p.A,{children:[(0,F.jsx)(m.A,{children:"Project"}),(0,F.jsx)(m.A,{children:"Clearance Date"}),(0,F.jsx)(m.A,{children:"Type"}),(0,F.jsx)(m.A,{children:"LAA"}),(0,F.jsx)(m.A,{children:"Removalist"}),(0,F.jsx)(m.A,{children:"Status"}),(0,F.jsx)(m.A,{children:"Actions"})]})}),(0,F.jsx)(y.A,{children:(s||[]).map((e=>(0,F.jsxs)(p.A,{children:[(0,F.jsx)(m.A,{children:de(e.projectId)}),(0,F.jsx)(m.A,{children:e.clearanceDate?new Date(e.clearanceDate).toLocaleDateString():"N/A"}),(0,F.jsx)(m.A,{children:e.clearanceType}),(0,F.jsx)(m.A,{children:e.LAA}),(0,F.jsx)(m.A,{children:e.asbestosRemovalist}),(0,F.jsx)(m.A,{children:(0,F.jsx)(g.A,{label:e.status,color:oe(e.status),size:"small"})}),(0,F.jsxs)(m.A,{children:[(0,F.jsx)(v.A,{onClick:()=>(e=>{a("/clearances/".concat(e._id,"/items"))})(e),color:"info",size:"small",title:"View Items",children:(0,F.jsx)(H.A,{})}),(0,F.jsx)(v.A,{onClick:()=>(e=>{ee(e),re({projectId:e.projectId._id||e.projectId,clearanceDate:e.clearanceDate?new Date(e.clearanceDate).toISOString().split("T")[0]:"",clearanceType:e.clearanceType,LAA:e.LAA,asbestosRemovalist:e.asbestosRemovalist,notes:e.notes||""}),Y(!0)})(e),color:"primary",size:"small",title:"Edit",children:(0,F.jsx)(z.A,{})}),(0,F.jsx)(v.A,{onClick:()=>(async e=>{try{se(!0);const a=await B.A.getById(e._id),s=await(0,U.Hj)("asbestos-clearance",a);ce({open:!0,message:"PDF generated successfully: ".concat(s),severity:"success"})}catch(a){console.error("Error generating PDF:",a),ce({open:!0,message:"Failed to generate PDF",severity:"error"})}finally{se(!1)}})(e),color:"secondary",size:"small",disabled:ae,title:"Generate PDF",children:(0,F.jsx)(W,{})}),(0,F.jsx)(v.A,{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this clearance?"))try{await B.A.delete(e._id),ce({open:!0,message:"Clearance deleted successfully",severity:"success"}),le()}catch(a){console.error("Error deleting clearance:",a),ce({open:!0,message:"Failed to delete clearance",severity:"error"})}})(e),color:"error",size:"small",title:"Delete",children:(0,F.jsx)(E.A,{})})]})]},e._id)))})]})})})}),(0,F.jsxs)(f.A,{open:X,onClose:()=>Y(!1),maxWidth:"md",fullWidth:!0,children:[(0,F.jsx)(b.A,{children:$?"Edit Clearance":"Add New Clearance"}),(0,F.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{$?(await B.A.update($._id,ne),ce({open:!0,message:"Clearance updated successfully",severity:"success"})):(await B.A.create(ne),ce({open:!0,message:"Clearance created successfully",severity:"success"})),Y(!1),ee(null),ie(),le()}catch(a){console.error("Error saving clearance:",a),ce({open:!0,message:"Failed to save clearance",severity:"error"})}},children:[(0,F.jsx)(C.A,{children:(0,F.jsxs)(w.Ay,{container:!0,spacing:2,children:[(0,F.jsx)(w.Ay,{item:!0,xs:12,children:(0,F.jsxs)(D.A,{fullWidth:!0,required:!0,children:[(0,F.jsx)(I.A,{children:"Project"}),(0,F.jsx)(S.A,{value:ne.projectId,onChange:e=>re((0,t.A)((0,t.A)({},ne),{},{projectId:e.target.value})),label:"Project",children:(G||[]).map((e=>(0,F.jsxs)(P.A,{value:e._id,children:[e.projectID,": ",e.name]},e._id)))})]})}),(0,F.jsx)(w.Ay,{item:!0,xs:12,md:6,children:(0,F.jsx)(k.A,{fullWidth:!0,type:"date",label:"Clearance Date",value:ne.clearanceDate,onChange:e=>re((0,t.A)((0,t.A)({},ne),{},{clearanceDate:e.target.value})),required:!0,InputLabelProps:{shrink:!0}})}),(0,F.jsx)(w.Ay,{item:!0,xs:12,md:6,children:(0,F.jsxs)(D.A,{fullWidth:!0,required:!0,children:[(0,F.jsx)(I.A,{children:"Clearance Type"}),(0,F.jsxs)(S.A,{value:ne.clearanceType,onChange:e=>re((0,t.A)((0,t.A)({},ne),{},{clearanceType:e.target.value})),label:"Clearance Type",children:[(0,F.jsx)(P.A,{value:"Non-friable",children:"Non-friable"}),(0,F.jsx)(P.A,{value:"Friable",children:"Friable"})]})]})}),(0,F.jsx)(w.Ay,{item:!0,xs:12,md:6,children:(0,F.jsx)(k.A,{fullWidth:!0,label:"LAA",value:ne.LAA,onChange:e=>re((0,t.A)((0,t.A)({},ne),{},{LAA:e.target.value})),required:!0})}),(0,F.jsx)(w.Ay,{item:!0,xs:12,md:6,children:(0,F.jsx)(k.A,{fullWidth:!0,label:"Asbestos Removalist",value:ne.asbestosRemovalist,onChange:e=>re((0,t.A)((0,t.A)({},ne),{},{asbestosRemovalist:e.target.value})),required:!0})}),(0,F.jsx)(w.Ay,{item:!0,xs:12,children:(0,F.jsx)(k.A,{fullWidth:!0,label:"Notes",value:ne.notes,onChange:e=>re((0,t.A)((0,t.A)({},ne),{},{notes:e.target.value})),multiline:!0,rows:3})})]})}),(0,F.jsxs)(L.A,{children:[(0,F.jsx)(o.A,{onClick:()=>Y(!1),children:"Cancel"}),(0,F.jsx)(o.A,{type:"submit",variant:"contained",children:$?"Update":"Create"})]})]})]}),(0,F.jsx)(R.A,{open:te.open,autoHideDuration:6e3,onClose:()=>ce((0,t.A)((0,t.A)({},te),{},{open:!1})),children:(0,F.jsx)(l.A,{onClose:()=>ce((0,t.A)((0,t.A)({},te),{},{open:!1})),severity:te.severity,children:te.message})})]})})}},76961:(e,a,s)=>{s.d(a,{A:()=>c});var t=s(82431);const c={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await t.A.get("/projects",{params:e})).data},getById:e=>t.A.get("/projects/".concat(e)),create:e=>t.A.post("/projects",e),update:(e,a)=>t.A.put("/projects/".concat(e),a),delete:e=>t.A.delete("/projects/".concat(e))}}}]);
//# sourceMappingURL=956.3fd24ac3.chunk.js.map