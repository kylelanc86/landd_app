"use strict";(self.webpackChunkair_monitoring_frontend=self.webpackChunkair_monitoring_frontend||[]).push([[227],{3632:(e,t,a)=>{a.d(t,{A:()=>s});var r=a(59662),o=a(70579);const s=(0,r.A)((0,o.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")},11227:(e,t,a)=>{a.r(t),a.d(t,{default:()=>M});var r=a(65043),o=a(73216),s=a(96446),n=a(85865),i=a(63336),c=a(15795),l=a(51787),d=a(17392),p=a(11906),h=a(81637),A=a(79650),j=a(71806),g=a(84882),x=a(28076),y=a(10039),u=a(73460),m=a(43845),v=a(67254),f=a(77739),w=a(59662),b=a(70579);const I=(0,w.A)((0,b.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),S=(0,w.A)((0,b.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");var _=a(3632),B=a(47968);const C=(0,w.A)((0,b.jsx)("path",{d:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3m-3 11H8v-5h8zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m-1-9H6v4h12z"}),"Print");var R=a(26240),k=a(63777),D=a(76961),z=a(32058),N=a(94505),P=a(94257);const M=()=>{(0,R.A)(),k.LU;const[e,t]=(0,r.useState)(""),[a,w]=(0,r.useState)([]),[M,E]=(0,r.useState)(null),[L,H]=(0,r.useState)([]),[F,T]=(0,r.useState)(!1),[V,W]=(0,r.useState)(!1),[U,J]=(0,r.useState)(!1),[K,O]=(0,r.useState)(""),[Z,q]=(0,r.useState)(new Set),G=((0,o.Zp)(),async function(){const t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:e)||e;if(t.trim())try{var a;W(!0),O(""),w([]),E(null),H([]);const r={page:1,limit:1e3,sortBy:"projectID",sortOrder:"desc",search:t.trim()};r.limit=parseInt(r.limit),console.log("Search params:",r),console.log("Current searchTerm:",e),console.log("Search term being used:",t.trim());const o=await D.A.getAll(r);console.log("Search response:",o);const s=Array.isArray(o.data)?o.data:(null===(a=o.data)||void 0===a?void 0:a.data)||[];console.log("Projects data:",s.length),w(s);const n=new Set;s.forEach((e=>{e.reports_present&&n.add(e._id)})),q(n),0===s.length&&O("No projects found matching your search term")}catch(r){console.error("Error searching projects:",r),O("Failed to search projects"),w([])}finally{W(!1)}else O("Please enter a search term")}),Q=e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"complete":return"success";case"in progress":return"warning";case"pending":return"info";default:return"default"}};return(0,b.jsxs)(s.A,{sx:{p:3},children:[(0,b.jsx)(n.A,{variant:"h4",component:"h1",gutterBottom:!0,sx:{mb:4},children:"Reports"}),(0,b.jsxs)(i.A,{sx:{p:3,mb:3},children:[(0,b.jsx)(n.A,{variant:"h6",gutterBottom:!0,children:"Search Projects"}),(0,b.jsxs)(s.A,{sx:{display:"flex",gap:2,alignItems:"flex-start",mb:2},children:[(0,b.jsx)(c.A,{fullWidth:!0,label:"Search for a project",placeholder:"Enter project ID, name, or client",value:e,onChange:e=>t(e.target.value),onKeyPress:t=>{"Enter"===t.key&&G(e)},InputProps:{startAdornment:(0,b.jsx)(I,{sx:{mr:1,color:"text.secondary"}}),endAdornment:e&&(0,b.jsx)(l.A,{position:"end",children:(0,b.jsx)(d.A,{size:"small",onClick:()=>{t(""),w([]),E(null),H([]),O(""),q(new Set)},edge:"end",children:(0,b.jsx)(S,{})})})}}),(0,b.jsx)(p.A,{variant:"contained",onClick:()=>G(e),disabled:!e.trim()||V,sx:{minWidth:140},children:V?(0,b.jsx)(h.A,{size:20,color:"inherit"}):"Search"})]}),a.length>0&&(0,b.jsxs)(s.A,{sx:{mt:2},children:[(0,b.jsxs)(n.A,{variant:"subtitle1",gutterBottom:!0,children:["Search Results (",a.length," projects found)"]}),(0,b.jsx)(A.A,{component:i.A,sx:{maxHeight:700},children:(0,b.jsxs)(j.A,{size:"small",children:[(0,b.jsx)(g.A,{children:(0,b.jsxs)(x.A,{children:[(0,b.jsx)(y.A,{children:"Project ID"}),(0,b.jsx)(y.A,{children:"Site Name"}),(0,b.jsx)(y.A,{children:"Reports"}),(0,b.jsx)(y.A,{align:"center",children:"Action"})]})}),(0,b.jsx)(u.A,{children:a.map((e=>{const t=Z.has(e._id);return(0,b.jsxs)(x.A,{children:[(0,b.jsx)(y.A,{children:(0,b.jsx)(n.A,{variant:"body2",fontWeight:"medium",children:e.projectID})}),(0,b.jsx)(y.A,{children:e.name}),(0,b.jsx)(y.A,{children:(0,b.jsx)(m.A,{label:t?"Reports Available":"No Reports",color:t?"success":"error",size:"small"})}),(0,b.jsx)(y.A,{align:"center",children:(0,b.jsx)(p.A,{variant:"contained",size:"small",color:"secondary",disabled:!t,onClick:()=>(async e=>{if(Z.has(e._id))try{J(!0),O("");const r=[];try{const t=await z.A.getAll({projectId:e._id});t.reports&&t.reports.forEach((e=>{var t;r.push({id:e._id,date:new Date(e.createdAt),type:"Asbestos Clearance Report",status:(null===(t=e.clearanceId)||void 0===t?void 0:t.status)||"Unknown",report:e})}))}catch(a){console.log("No clearance reports found for this project")}try{var t;const o=(null===(t=(await N.D4.getAll()).data)||void 0===t?void 0:t.filter((t=>{var a;return t.project===e._id||(null===(a=t.project)||void 0===a?void 0:a._id)===e._id})))||[];for(const e of o)try{((await N.sA.getByJob(e._id)).data||[]).forEach((t=>{("analysis_complete"===t.status||"shift_complete"===t.status||t.reportApprovedBy)&&r.push({id:t._id,date:new Date(t.reportIssueDate||t.updatedAt||t.createdAt),type:"Air Monitoring Report",status:t.reportApprovedBy?"Authorized":t.status,report:t,jobName:e.name,shiftName:t.name})}))}catch(a){console.log("No shifts found for job ".concat(e._id))}}catch(a){console.log("No air monitoring reports found for this project")}r.sort(((e,t)=>t.date-e.date)),H(r),E(e)}catch(a){console.error("Error loading reports:",a),O("Failed to load reports for this project")}finally{J(!1)}})(e),children:"Load Reports"})})]},e._id)}))})]})})]})]}),K&&(0,b.jsx)(v.A,{severity:"error",sx:{mb:3},children:K}),L.length>0&&(0,b.jsxs)(i.A,{sx:{p:3},children:[(0,b.jsxs)(n.A,{variant:"h6",gutterBottom:!0,children:["Reports for ",null===M||void 0===M?void 0:M.projectID]}),(0,b.jsx)(A.A,{children:(0,b.jsxs)(j.A,{children:[(0,b.jsx)(g.A,{children:(0,b.jsxs)(x.A,{children:[(0,b.jsx)(y.A,{children:"Date"}),(0,b.jsx)(y.A,{children:"Report Type"}),(0,b.jsx)(y.A,{children:"Status"}),(0,b.jsx)(y.A,{align:"center",children:"Actions"})]})}),(0,b.jsx)(u.A,{children:L.map((e=>(0,b.jsxs)(x.A,{children:[(0,b.jsx)(y.A,{children:e.date.toLocaleDateString()}),(0,b.jsxs)(y.A,{children:[(0,b.jsx)(n.A,{variant:"body2",fontWeight:"medium",children:e.type}),e.jobName&&(0,b.jsxs)(n.A,{variant:"caption",color:"text.secondary",children:[e.jobName," \u2022 ",e.shiftName]})]}),(0,b.jsx)(y.A,{children:(0,b.jsx)(m.A,{label:e.status,color:Q(e.status),size:"small"})}),(0,b.jsx)(y.A,{align:"center",children:(0,b.jsxs)(s.A,{sx:{display:"flex",gap:1,justifyContent:"center"},children:[(0,b.jsx)(f.A,{title:"View Report",children:(0,b.jsx)(d.A,{size:"small",onClick:()=>(async e=>{try{if("Air Monitoring Report"===e.type){var t;const a=e.report,r=await N.D4.getById((null===(t=a.job)||void 0===t?void 0:t._id)||a.job),o=await N.kw.getByShift(a._id),s=await Promise.all(o.data.map((async e=>e.analysis?e:(await N.kw.getById(e._id)).data)));let n=r.data.project;if(n&&"string"===typeof n&&(n=(await D.A.getById(n)).data),n&&n.client&&"string"===typeof n.client){const e=await N.Lx.getById(n.client);n.client=e.data}(0,P.c)({shift:a,job:r.data,samples:s,project:n,openInNewTab:!0})}else"Asbestos Clearance Report"===e.type&&console.log("Viewing asbestos clearance report:",e)}catch(a){console.error("Error viewing report:",a),O("Failed to view report")}})(e),color:"primary",children:(0,b.jsx)(_.A,{})})}),(0,b.jsx)(f.A,{title:"Download Report",children:(0,b.jsx)(d.A,{size:"small",onClick:()=>(async e=>{try{if("Air Monitoring Report"===e.type){var t;const a=e.report,r=await N.D4.getById((null===(t=a.job)||void 0===t?void 0:t._id)||a.job),o=await N.kw.getByShift(a._id),s=await Promise.all(o.data.map((async e=>e.analysis?e:(await N.kw.getById(e._id)).data)));let n=r.data.project;if(n&&"string"===typeof n&&(n=(await D.A.getById(n)).data),n&&n.client&&"string"===typeof n.client){const e=await N.Lx.getById(n.client);n.client=e.data}(0,P.c)({shift:a,job:r.data,samples:s,project:n,openInNewTab:!1})}else"Asbestos Clearance Report"===e.type&&console.log("Downloading asbestos clearance report:",e)}catch(a){console.error("Error downloading report:",a),O("Failed to download report")}})(e),color:"secondary",children:(0,b.jsx)(B.A,{})})}),(0,b.jsx)(f.A,{title:"Print Report",children:(0,b.jsx)(d.A,{size:"small",onClick:()=>(async e=>{try{if("Air Monitoring Report"===e.type){var t;const a=e.report,r=await N.D4.getById((null===(t=a.job)||void 0===t?void 0:t._id)||a.job),o=await N.kw.getByShift(a._id),s=await Promise.all(o.data.map((async e=>e.analysis?e:(await N.kw.getById(e._id)).data)));let n=r.data.project;if(n&&"string"===typeof n&&(n=(await D.A.getById(n)).data),n&&n.client&&"string"===typeof n.client){const e=await N.Lx.getById(n.client);n.client=e.data}(0,P.c)({shift:a,job:r.data,samples:s,project:n,openInNewTab:!0}),setTimeout((()=>{window.print()}),1e3)}else"Asbestos Clearance Report"===e.type&&console.log("Printing asbestos clearance report:",e)}catch(a){console.error("Error printing report:",a),O("Failed to print report")}})(e),color:"info",children:(0,b.jsx)(C,{})})})]})})]},e.id)))})]})})]}),M&&!U&&0===L.length&&!K&&(0,b.jsxs)(i.A,{sx:{p:3,textAlign:"center"},children:[(0,b.jsx)(n.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Reports Found"}),(0,b.jsx)(n.A,{variant:"body2",color:"text.secondary",children:"No reports have been generated for this project yet."})]})]})}},32058:(e,t,a)=>{a.d(t,{A:()=>s});var r=a(82431);const o="/asbestos-clearance-reports",s={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await r.A.get(o,{params:e})).data},getByClearanceId:async e=>(await r.A.get("".concat(o,"/clearance/").concat(e))).data,getById:async e=>(await r.A.get("".concat(o,"/").concat(e))).data,create:async e=>(await r.A.post(o,e)).data,update:async(e,t)=>(await r.A.put("".concat(o,"/").concat(e),t)).data,delete:async e=>(await r.A.delete("".concat(o,"/").concat(e))).data}},47968:(e,t,a)=>{a.d(t,{A:()=>s});var r=a(59662),o=a(70579);const s=(0,r.A)((0,o.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download")},76961:(e,t,a)=>{a.d(t,{A:()=>o});var r=a(82431);const o={getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await r.A.get("/projects",{params:e})).data},getById:e=>r.A.get("/projects/".concat(e)),create:e=>r.A.post("/projects",e),update:(e,t)=>r.A.put("/projects/".concat(e),t),delete:e=>r.A.delete("/projects/".concat(e))}}}]);
//# sourceMappingURL=227.886769d9.chunk.js.map